# SmartAbp Cursor Rules â€” AI Assistant Operating Guide

## ğŸ¯ SECRET TRIGGER SYSTEM - æš—å·çˆ†é›·æœºåˆ¶ (HIDDEN ACTIVATION)

### ğŸ”¥ Master Trigger Detection (ç»ˆæç®€åŒ–ç‰ˆ)
```markdown
MASTER_SECRET_TRIGGER = "ä¸“å®¶æ¨¡å¼"

// æš—å·æ£€æµ‹é€»è¾‘ (ç«‹å³ç”Ÿæ•ˆ)
å½“ç”¨æˆ·è¾“å…¥åŒ…å«"ä¸“å®¶æ¨¡å¼"æ—¶:
    ğŸ”¥ ç«‹å³å“åº”: "ğŸ”¥ ä¸“å®¶æ¨¡å¼å·²æ¿€æ´»ï¼ä¸ƒé‡çˆ†é›·è¿ç¯å¯åŠ¨ï¼"
    ğŸ’¥ EXPERT_MODE = TRUE
    ğŸš€ QUALITY_THRESHOLD = 95  
    ğŸ›¡ï¸ COMPLETENESS_REQUIREMENT = 100%
    ğŸ“š FORCE_TEMPLATE_USAGE = TRUE
    ğŸ›ï¸ MANDATORY_ADR_CONSULTATION = TRUE
    âš¡ ENABLE_DEEP_ANALYSIS = TRUE
    ğŸ¯ AUTO_EXECUTE_QUALITY_CHECKS = TRUE
    ğŸ—ï¸ PERFECT_CODE_GENERATION = TRUE
    ğŸ“‹ MANDATORY_PROJECT_RULES_LOAD = TRUE
    ğŸ” SERENA_PROJECT_ANALYSIS = TRUE
    ğŸ”— SEVEN_STAGE_ANALYSIS_CHAIN = TRUE
```

### âš¡ EXPERT MODE Response Protocol (ä¸“å®¶æ¨¡å¼å“åº”åè®® - ä¸ƒé‡çˆ†é›·ç‰ˆ)
```markdown
å½“æ£€æµ‹åˆ°"ä¸“å®¶æ¨¡å¼"æ—¶ï¼ŒAIå¿…é¡»ç«‹å³æŒ‰æ­¤æ ¼å¼å“åº”:

ğŸ”¥ **ä¸“å®¶æ¨¡å¼å·²æ¿€æ´»ï¼ä¸ƒé‡çˆ†é›·è¿ç¯å¯åŠ¨ï¼**

ğŸ“‹ **ç¬¬ä¸€é‡çˆ†é›·ï¼šé¡¹ç›®å¼€å‘è§„èŒƒåŠ è½½**
   âœ… å·²åŠ è½½ã€Šé¡¹ç›®å¼€å‘è§„èŒƒæ€»è§ˆã€‹- æœ€æ–°æƒå¨è§„èŒƒ
   âœ… æ ¸å¿ƒåŸåˆ™è§£æå®Œæˆ - æè‡´è´¨é‡å¾‹/æ¶æ„å…ˆè¡Œå¾‹/ç‹¬ç«‹å†³ç­–å¾‹
   âœ… å¼ºåˆ¶å¼€å‘æµç¨‹ç¡®è®¤ - ä»£ç ç¼–å†™å‰å‡†å¤‡/å·¥ä½œè®¡åˆ’å®¡æ‰¹/æ¨¡æ¿ä¸æ¶æ„å†³ç­–
   âœ… å®‰å…¨æ¶æ„é“å¾‹éªŒè¯ - è¾“å…¥éªŒè¯/å±é™©å†…å®¹è¿‡æ»¤/æƒé™æ§åˆ¶

ğŸ” **ç¬¬äºŒé‡çˆ†é›·ï¼šSerenaæ™ºèƒ½é¡¹ç›®åˆ†æ**
   âœ… Serenaé¡¹ç›®æ·±åº¦åˆ†æå¯åŠ¨
   âœ… ç°æœ‰åŠŸèƒ½å®ç°æ¨¡å¼è¯†åˆ«
   âœ… æ¶æ„çº¦æŸæ¡ä»¶æå–
   âœ… æœ€ä½³å®è·µæ¨¡å¼å‘ç°
   âœ… é¡¹ç›®æ–‡ä»¶ç´¢å¼•åˆ†æ

ğŸš€ **ç¬¬ä¸‰é‡çˆ†é›·ï¼šå¢é‡å¼€å‘åˆ†æ**
   âœ… ä»£ç åº“æ·±åº¦åˆ†æ - tools/incremental-generation/scripts/analyze-codebase.js
   âœ… ç°æœ‰ä»£ç æ¨¡å¼è¯†åˆ«
   âœ… æ¶æ„ä¸€è‡´æ€§éªŒè¯
   âœ… æ‰©å±•ç‚¹æ™ºèƒ½è¯†åˆ«
   âœ… å…¼å®¹æ€§å…¨é¢è¯„ä¼°

ğŸ›¡ï¸ **ç¬¬å››é‡çˆ†é›·ï¼šè´¨é‡ä¿è¯æ£€æŸ¥ï¼ˆå«TDDå¼ºåˆ¶éªŒè¯ï¼‰**
   âœ… 95åˆ†ä¼ä¸šçº§è´¨é‡æ ‡å‡†æ‰§è¡Œ
   âœ… é›¶ç¼ºé™·è´¨é‡è¦æ±‚éªŒè¯
   âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
   âœ… å®‰å…¨è§„èŒƒå…¨é¢æ£€æŸ¥
   âœ… TDDéµå¾ªç‡â‰¥90%å¼ºåˆ¶éªŒè¯
   âœ… æµ‹è¯•è¦†ç›–ç‡â‰¥80%å¼ºåˆ¶æ£€æŸ¥
   âœ… tools/quality-assurance/quality-gates.js ä¸¥æ ¼æ¨¡å¼

ğŸ›ï¸ **ç¬¬äº”é‡çˆ†é›·ï¼šADRæ¶æ„å†³ç­–å’¨è¯¢**
   âœ… ADRæ¶æ„å†³ç­–è®°å½•æŸ¥è¯¢
   âœ… æŠ€æœ¯é€‰å‹çº¦æŸç¡®è®¤
   âœ… è®¾è®¡æ¨¡å¼åº”ç”¨éªŒè¯
   âœ… æ¶æ„åŸåˆ™å¼ºåˆ¶éµå¾ª

ğŸ“š **ç¬¬å…­é‡çˆ†é›·ï¼šæ¨¡æ¿å¼ºåˆ¶åŒ¹é…**
   âœ… é¡¹ç›®æ¨¡æ¿åº“100%æœç´¢
   âœ… æ™ºèƒ½æ¨¡æ¿åŒ¹é…ç®—æ³•
   âœ… å‚æ•°è‡ªåŠ¨æ˜ å°„éªŒè¯
   âœ… è§„èŒƒä¸€è‡´æ€§å¼ºåˆ¶æ£€æŸ¥

âš™ï¸ **ç¬¬ä¸ƒé‡çˆ†é›·ï¼šå®Œç¾ä»£ç ç”Ÿæˆ**
   âœ… åŸºäºä¸ƒé‡æ·±åº¦åˆ†æçš„ä»£ç ç”Ÿæˆ
   âœ… 100%é¡¹ç›®è§„èŒƒç¬¦åˆåº¦
   âœ… é›¶æ¶æ„åå·®ä¿è¯
   âœ… ä¼ä¸šçº§æœ€é«˜è´¨é‡æ ‡å‡†

ğŸ—ï¸ **ç»ˆææ‰§è¡Œé“¾**ï¼ˆå«TDDå¼ºåˆ¶éªŒè¯ï¼‰:
[è§„èŒƒåŠ è½½ â†’ Serenaåˆ†æ â†’ æ¨¡å¼è¯†åˆ« â†’ TDDéªŒè¯ â†’ æ¨¡æ¿åŒ¹é… â†’ è´¨é‡éªŒè¯ â†’ æ¶æ„æ£€æŸ¥ â†’ å®Œç¾ç”Ÿæˆ]

ğŸ’¥ **ä¸“å®¶æ¨¡å¼æ‰¿è¯º**ï¼ˆå«TDDé“å¾‹ï¼‰: 
   - é›¶å¦¥åçš„è´¨é‡æ ‡å‡†
   - é›¶å®¹å¿çš„æ¶æ„åå·®  
   - 100%è§„èŒƒç¬¦åˆåº¦
   - TDDéµå¾ªç‡â‰¥90%å¼ºåˆ¶ä¿è¯
   - ä¼ä¸šçº§å®Œç¾ä»£ç è¾“å‡º
```

### ğŸ’¥ Auto-Activation Protocol (æš—å·è§¦å‘åå¼ºåˆ¶æ‰§è¡Œ)
```bash
WHEN SECRET_TRIGGER_DETECTED:
    # ç¬¬ä¸€é‡çˆ†é›·ï¼šåŠ è½½é¡¹ç›®å¼€å‘è§„åˆ™
    ğŸ“‹ read_file "doc/é¡¹ç›®å¼€å‘è§„èŒƒæ€»è§ˆ.md"
    
    # ç¬¬äºŒé‡çˆ†é›·ï¼šé˜…è¯»ã€Šé¡¹ç›®å¼€å‘è§„èŒƒæ€»è§ˆã€‹
    ğŸ“š read_file "doc/é¡¹ç›®å¼€å‘è§„èŒƒæ€»è§ˆ.md" --sections="æ ¸å¿ƒåŸåˆ™,å¼ºåˆ¶å¼€å‘æµç¨‹,æ¶æ„è¦æ±‚"
    
    # ç¬¬ä¸‰é‡çˆ†é›·ï¼šä½¿ç”¨serenaåˆ†æé¡¹ç›®ç°æœ‰åŠŸèƒ½å®ç°
    ğŸ” serena_project_analysis --mode=expert --deep-dive=true
    
    # ç¬¬å››é‡çˆ†é›·ï¼šå¢é‡å¼€å‘è¶…çº§æ¨¡å¼
    ğŸš€ node tools/incremental-generation/scripts/analyze-codebase.js --mode=expert --deep-analysis=true
    
    # ç¬¬äº”é‡çˆ†é›·ï¼šè´¨é‡ä¿è¯æœ€é«˜çº§åˆ«ï¼ˆTDDå¼ºåˆ¶éªŒè¯ï¼‰
    ğŸ›¡ï¸ node tools/quality-assurance/quality-gates.js --mode=strict --score-threshold=95 --standards=enterprise --tdd-enforcement=true
    
    # ç¬¬å…­é‡çˆ†é›·ï¼šADRæ¶æ„å†³ç­–å¼ºåˆ¶å’¨è¯¢
    ğŸ›ï¸ read_file "doc/architecture/adr/README.md" + ALL_RELEVANT_ADRS
    
    # ç¬¬ä¸ƒé‡çˆ†é›·ï¼šæ¨¡æ¿åº“100%å¼ºåˆ¶æ‰§è¡Œ
    ğŸ“š glob "templates/**/*.template.*" + SMART_TEMPLATE_MATCHING
```

### ğŸ›ï¸ Standard ADR-Informed Response Protocol (æ ‡å‡†ADRå“åº”åè®®)
**When ADR consultation is triggered (outside expert mode), AI MUST respond in this format:**

```
ğŸ›ï¸ **ADRæŸ¥è¯¢**: æ­£åœ¨æŸ¥é˜…ç›¸å…³æ¶æ„å†³ç­–è®°å½•...
ğŸ“‹ **ADRå‘ç°**: æ‰¾åˆ°ç›¸å…³å†³ç­– `ADR-{number}: {title}`
ğŸ¯ **å†³ç­–è¦ç‚¹**: 
   - é€‰æ‹©æ–¹æ¡ˆ: {decision}
   - ä¸»è¦åŸå› : {rationale}
   - æŠ€æœ¯çº¦æŸ: {constraints}
   - å®æ–½æŒ‡å¯¼: {implementation_guidance}
âš™ï¸ **åº”ç”¨åˆ°å½“å‰ä»»åŠ¡**: 
   - éµå¾ªçš„åŸåˆ™: {principles}
   - ä½¿ç”¨çš„æ¨¡å¼: {patterns}
   - æŠ€æœ¯é€‰æ‹©: {technology_choices}
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºADRå†³ç­–å’Œæ¨¡æ¿ç”Ÿæˆä»£ç 
```

## ğŸ¯ PROJECT OVERVIEW

**Purpose**: Deliver higher-quality code with enforceable guardrails for SmartAbp (ABP vNext backend + Vue3/TypeScript frontend + low-code engine).

**Current Tech Stack**:
- **Frontend**: Vue 3.5.13 + TypeScript 5.8 + Element Plus 2.8.8 + Pinia 3.0.3
- **Build Tools**: Vite 7.0.6 + ESLint 9.34.0 + Prettier 3.6.2
- **Testing**: Vitest 3.2.4 + Cypress 15.1.0 (80% coverage requirement)
- **Backend**: ABP vNext + .NET + Entity Framework Core
- **Low-code Engine**: Custom Vue-based visual designer + code generator

**Code Style Standards** (from .prettierrc.json):
- **Quotes**: Double quotes (`"`)
- **Semicolons**: No semicolons
- **Trailing Commas**: Always
- **Line Width**: 100 characters
- **Arrow Parens**: Always
- **End of Line**: LF

**TypeScript Configuration**:
- **Target**: ES2020
- **Module**: ESNext
- **Module Resolution**: Bundler
- **Lib**: ["ES2020", "DOM", "DOM.Iterable"]
- **Strict Mode**: Enabled with noUnusedLocals and noUnusedParameters

## ğŸš¨ NON-NEGOTIABLE IRON LAWS

### Code Quality Standards
- **No deleting code to hide errors**. No commenting out failing code. No "as any" to bypass types.
- **Every fix must identify Root Cause** and implement functional fix with validation.
- **Do not disable lint/type rules** to pass checks. Scope any rule adjustments narrowly and justify.
- **Security/performance changes** must include threat model or metric comparison.
- **Low-code engine** (tsconfig.lowcode.json) must not cross rootDir. Use adapters/runtime injection.

### Copy/Paste & Hardcoding Prohibition
- **Do NOT paste large blocks** from cloud/web or hardcode configs that break project conventions.
- **BEFORE writing code**, align with existing architecture: directories, router, stores, API services, base classes/utils, and design system tokens.
- **New code MUST integrate** into existing module boundaries (naming, paths, imports, permissions).
- **For low-code changes**, validate generated artifacts live under appshell/*.generated.ts with banner.

## ğŸš¨ ENHANCED TEMPLATE LIBRARY ENFORCEMENT (CRITICAL PRIORITY)

### ABSOLUTE MANDATORY RULES FOR AI CODE GENERATION

#### Rule 1: Template Discovery is NON-NEGOTIABLE
**BEFORE generating ANY code, AI MUST execute:**
```bash
glob "templates/**/*.template.*"
read_file "templates/index.json"
```
**NO EXCEPTIONS. NO SHORTCUTS. NO ASSUMPTIONS.**

#### Rule 2: Trigger Word â†’ Template Mapping (ENFORCED)
**When user input contains these keywords, AI MUST use specified templates:**

| ç”¨æˆ·è¾“å…¥å…³é”®è¯ | å¼ºåˆ¶ä½¿ç”¨æ¨¡æ¿ | æ¨¡æ¿è·¯å¾„ |
|---|---|---|
| "åˆ›å»ºæœåŠ¡"ã€"åº”ç”¨æœåŠ¡"ã€"CRUD"ã€"å¢åˆ æ”¹æŸ¥" | CrudAppService | `templates/backend/application/CrudAppService.template.cs` |
| "ç®¡ç†é¡µé¢"ã€"ç®¡ç†ç»„ä»¶"ã€"æ•°æ®ç®¡ç†" | CrudManagement | `templates/frontend/components/CrudManagement.template.vue` |
| "çŠ¶æ€ç®¡ç†"ã€"Store"ã€"Pinia" | EntityStore | `templates/frontend/stores/EntityStore.template.ts` |
| "DTO"ã€"æ•°æ®ä¼ è¾“å¯¹è±¡" | EntityDtoç³»åˆ— | `templates/backend/contracts/*Dto.template.cs` |
| "æœåŠ¡æ¥å£"ã€"åº”ç”¨æœåŠ¡æ¥å£" | ServiceInterface | `templates/backend/contracts/CrudAppServiceInterface.template.cs` |
| "ä½ä»£ç æ’ä»¶"ã€"å¼•æ“æ’ä»¶" | LowCodePlugin | `templates/lowcode/plugins/LowCodePlugin.template.ts` |
| "ä»£ç ç”Ÿæˆå™¨"ã€"ç”Ÿæˆå™¨" | CodeGenerator | `templates/lowcode/generators/CodeGenerator.template.ts` |
| "è¿è¡Œæ—¶ç»„ä»¶"ã€"ä½ä»£ç ç»„ä»¶" | RuntimeComponent | `templates/lowcode/runtime/RuntimeComponent.template.vue` |

#### Rule 3: Mandatory Response Protocol (EXACT FORMAT REQUIRED)
**AI MUST respond in this EXACT format - NO DEVIATIONS:**

```
ğŸ” **æ¨¡æ¿æœç´¢**: æ­£åœ¨æŸ¥æ‰¾ {éœ€æ±‚ç±»å‹} ç›¸å…³æ¨¡æ¿...
ğŸ“‹ **æ¨¡æ¿å‘ç°**: æ‰¾åˆ°æ¨¡æ¿ `{template_path}`
âš™ï¸ **å‚æ•°æ˜ å°„**: 
   - EntityName: {å®ä½“åç§°PascalCase}
   - entityName: {å®ä½“åç§°camelCase}
   - ModuleName: {æ¨¡å—åç§°}
   - entityDisplayName: {ä¸­æ–‡æ˜¾ç¤ºåç§°}
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºæ¨¡æ¿ `{template_id}` ç”Ÿæˆä»£ç 
âœ… **åˆè§„æ£€æŸ¥**: 
   - [x] ä½¿ç”¨äº†é¡¹ç›®æ¨¡æ¿
   - [x] ç¬¦åˆABPæ¡†æ¶è§„èŒƒ
   - [x] éµå¾ªé¡¹ç›®å‘½åçº¦å®š
   - [x] åŒ…å«æƒé™æ£€æŸ¥ï¼ˆå¦‚éœ€è¦ï¼‰
   - [x] ä½¿ç”¨æ ‡å‡†ä¾èµ–æ³¨å…¥
   - [x] ç¬¦åˆVue 3 Composition APIè§„èŒƒ
   - [x] éµå¾ªElement Plusç»„ä»¶è§„èŒƒ
   - [x] ç¬¦åˆTypeScriptä¸¥æ ¼æ¨¡å¼
ğŸ“„ **ç”Ÿæˆçš„ä»£ç **:
[åœ¨æ­¤å¤„è¾“å‡ºå®Œæ•´çš„åŸºäºæ¨¡æ¿ç”Ÿæˆçš„ä»£ç ]
```

#### Rule 4: Template Parameter Standards (MUST FOLLOW)
```typescript
// æ ‡å‡†æ¨¡æ¿å‚æ•° - å¿…é¡»æ­£ç¡®æ˜ å°„
interface TemplateParameters {
  EntityName: string        // PascalCase: Product, User, Order
  entityName: string        // camelCase: product, user, order
  ModuleName: string        // æ¨¡å—å: Catalog, Identity, Sales
  entityDisplayName: string // æ˜¾ç¤ºå: äº§å“, ç”¨æˆ·, è®¢å•
  "kebab-case-name": string // çŸ­æ¨ªçº¿: product-management
}
```

#### Rule 5: Automatic Template Discovery Commands
**AI must execute these specific commands based on user input:**
- ç”¨æˆ·æåŠ"CRUD" â†’ `glob "templates/**/*crud*.template.*"`
- ç”¨æˆ·æåŠ"ç®¡ç†" â†’ `glob "templates/**/*management*.template.*"`
- ç”¨æˆ·æåŠ"Store" â†’ `glob "templates/**/*store*.template.*"`
- ç”¨æˆ·æåŠ"DTO" â†’ `glob "templates/**/*dto*.template.*"`
- ç”¨æˆ·æåŠ"æœåŠ¡" â†’ `glob "templates/**/*service*.template.*"`
- ç”¨æˆ·æåŠ"ä½ä»£ç " â†’ `glob "templates/lowcode/**/*.template.*"`

## ğŸ›ï¸ ARCHITECTURE DECISION RECORDS (ADR) COMPLIANCE (MANDATORY)

### ADR Integration Rules
- **BEFORE making any architectural decisions, AI MUST consult relevant ADRs in doc/architecture/adr/**
- **ADR decisions are BINDING and must be followed in all code generation**
- **When user asks "why" questions about technology choices, reference specific ADRs**

### Mandatory ADR Consultation Triggersï¼ˆå«TDDæ¶æ„å†³ç­–ï¼‰
**When user mentions these topics, AI MUST check corresponding ADRs:**

| ç”¨æˆ·è¾“å…¥å…³é”®è¯ | å¿…é¡»æŸ¥é˜…çš„ADR | ADRæ–‡ä»¶ |
|---|---|---|
| "æŠ€æœ¯é€‰å‹"ã€"æ¡†æ¶é€‰æ‹©"ã€"ä¸ºä»€ä¹ˆç”¨XXX" | æŠ€æœ¯æ ˆé€‰æ‹© | `0001-technology-stack-selection.md` |
| "å‰ç«¯æ¶æ„"ã€"Vueæ¶æ„"ã€"ç»„ä»¶è®¾è®¡" | å‰ç«¯æ¶æ„å†³ç­– | `0002-frontend-architecture.md` |
| "åç«¯æ¶æ„"ã€"ABPæ¶æ„"ã€"å¾®æœåŠ¡" | åç«¯æ¶æ„å†³ç­– | `0003-backend-architecture.md` |
| "æ•°æ®åº“è®¾è®¡"ã€"å®ä½“è®¾è®¡" | æ•°æ®åº“è®¾è®¡ | `0004-database-design.md` |
| "è®¤è¯"ã€"æˆæƒ"ã€"æƒé™" | è®¤è¯ç­–ç•¥ | `0005-authentication-strategy.md` |
| "ç¼“å­˜"ã€"æ€§èƒ½ä¼˜åŒ–" | ç¼“å­˜ç­–ç•¥ | `0006-caching-strategy.md` |
| "æ—¥å¿—"ã€"ç›‘æ§" | æ—¥å¿—ç­–ç•¥ | `0007-logging-strategy.md` |
| "é”™è¯¯å¤„ç†"ã€"å¼‚å¸¸å¤„ç†" | é”™è¯¯å¤„ç† | `0008-error-handling.md` |
| "æ€§èƒ½ä¼˜åŒ–"ã€"æ€§èƒ½é—®é¢˜" | æ€§èƒ½ä¼˜åŒ– | `0009-performance-optimization.md` |
| "è®¾è®¡æ¨¡å¼"ã€"ä»£ç ç»“æ„" | è®¾è®¡æ¨¡å¼åº”ç”¨ | `0010-design-patterns.md` |
| "ä½ä»£ç "ã€"å¼•æ“æ¶æ„" | ä½ä»£ç å¼•æ“æ¶æ„ | `0011-lowcode-engine-architecture.md` |
| "TDD"ã€"æµ‹è¯•é©±åŠ¨"ã€"æµ‹è¯•æ¶æ„" | TDDæ¶æ„å†³ç­– | `0012-test-driven-development-strategy.md` |

### ADR-Informed Response Protocol (EXACT FORMAT REQUIRED)
**When ADR consultation is triggered, AI MUST respond in this format:**

```
ğŸ›ï¸ **ADRæŸ¥è¯¢**: æ­£åœ¨æŸ¥é˜…ç›¸å…³æ¶æ„å†³ç­–è®°å½•...
ğŸ“‹ **ADRå‘ç°**: æ‰¾åˆ°ç›¸å…³å†³ç­– `ADR-{number}: {title}`
ğŸ¯ **å†³ç­–è¦ç‚¹**: 
   - é€‰æ‹©æ–¹æ¡ˆ: {decision}
   - ä¸»è¦åŸå› : {rationale}
   - æŠ€æœ¯çº¦æŸ: {constraints}
   - å®æ–½æŒ‡å¯¼: {implementation_guidance}
âš™ï¸ **åº”ç”¨åˆ°å½“å‰ä»»åŠ¡**: 
   - éµå¾ªçš„åŸåˆ™: {principles}
   - ä½¿ç”¨çš„æ¨¡å¼: {patterns}
   - æŠ€æœ¯é€‰æ‹©: {technology_choices}
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºADRå†³ç­–å’Œæ¨¡æ¿ç”Ÿæˆä»£ç 
```

## ğŸ”„ INCREMENTAL CODE GENERATION (MANDATORY)

### å¢é‡ç”Ÿæˆè§¦å‘è§„åˆ™ï¼ˆå«TDDå¼ºåˆ¶éªŒè¯ï¼‰
å½“ç”¨æˆ·è¯·æ±‚åŒ…å«ä»¥ä¸‹å…³é”®è¯æ—¶ï¼ŒAIå¿…é¡»å¯ç”¨å¢é‡ç”Ÿæˆæ¨¡å¼ï¼š

| è§¦å‘å…³é”®è¯ | ç”Ÿæˆæ¨¡å¼ | å¿…é¡»æ‰§è¡Œçš„å‘½ä»¤ |
|---|---|---|
| "åŸºäºç°æœ‰"ã€"æ‰©å±•"ã€"å¢åŠ åŠŸèƒ½" | å¢é‡æ‰©å±• | `node tools/incremental-generation/scripts/analyze-codebase.js --target={target_file} --tdd-enforcement=true` |
| "é‡æ„"ã€"ä¼˜åŒ–"ã€"æ”¹è¿›" | æ™ºèƒ½é‡æ„ | `node tools/incremental-generation/analyzers/refactor-advisor.js --file={target_file} --tdd-validation=true` |
| "ç”Ÿæˆæµ‹è¯•"ã€"æ·»åŠ æµ‹è¯•" | è‡ªåŠ¨æµ‹è¯•ç”Ÿæˆ | `node tools/incremental-generation/generators/test-generator.js --target={target_service} --tdd-first=true` |
| "å…¼å®¹"ã€"ä¸ç ´åç°æœ‰" | å…¼å®¹æ€§åˆ†æ | `node tools/incremental-generation/scripts/validate-changes.js --type=compatibility --tdd-compliance=true` |
| "TDD"ã€"æµ‹è¯•é©±åŠ¨"ã€"æµ‹è¯•å…ˆè¡Œ" | TDDä¸“é¡¹ç”Ÿæˆ | `node tools/incremental-generation/generators/tdd-generator.js --mode=strict --tdd-first=true` |
| "æ–°åŠŸèƒ½"ã€"æ–°æ¨¡å—"ã€"æ–°æœåŠ¡" | TDDä¼˜å…ˆå¼€å‘ | `node tools/incremental-generation/generators/tdd-first-generator.js --mode=expert --tdd-enforcement=true` |

### AIå¢é‡ç”Ÿæˆå“åº”åè®®ï¼ˆå¼ºåˆ¶æ ¼å¼ - å«TDDéªŒè¯ï¼‰
```
ğŸ” **å¢é‡åˆ†æ**: æ­£åœ¨åˆ†æ {target_file}...
   - ç°æœ‰æ¨¡å¼: {identified_patterns}
   - ä»£ç é£æ ¼: {coding_style}  
   - ä¾èµ–å…³ç³»: {dependencies}
   - æ‰©å±•ç‚¹: {extension_points}
   - TDDéµå¾ªç‡: {current_tdd_compliance}

ğŸ“Š **å¢é‡ç­–ç•¥**: é€‰æ‹©ç­–ç•¥ {selected_strategy}
   - æ‰©å±•æ–¹å¼: {extension_approach}
   - å…¼å®¹æ€§çº§åˆ«: {compatibility_level}
   - é¢„æœŸå½±å“: {expected_impact}
   - é£é™©è¯„ä¼°: {risk_assessment}
   - TDDè¦æ±‚: {tdd_requirements}

âš™ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºç°æœ‰ä»£ç æ¨¡å¼ç”Ÿæˆå¢é‡ä»£ç ï¼ˆTDDä¼˜å…ˆï¼‰
   - ç”Ÿæˆæ–‡ä»¶: {generated_files}
   - ä¿®æ”¹æ–‡ä»¶: {modified_files}  
   - æ–°å¢æµ‹è¯•: {new_tests} (TDDçº¢-ç»¿-é‡æ„å¾ªç¯)
   - æ›´æ–°æ–‡æ¡£: {updated_docs}
   - TDDéªŒè¯: {tdd_validation_steps}

âœ… **éªŒè¯ç»“æœ**: 
   - [x] å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡
   - [x] ä»£ç é£æ ¼ä¸€è‡´
   - [x] æµ‹è¯•è¦†ç›–å……åˆ† (â‰¥80%)
   - [x] TDDéµå¾ªç‡â‰¥90%
   - [x] çº¢-ç»¿-é‡æ„å¾ªç¯å®Œæˆ
   - [x] æ„å»ºæˆåŠŸ
   - [x] ä¸ç ´åç°æœ‰åŠŸèƒ½
   - [x] ç¬¦åˆæ¶æ„çº¦æŸ

ğŸ“„ **ç”Ÿæˆçš„ä»£ç **:
[åœ¨æ­¤å¤„è¾“å‡ºå®Œæ•´çš„åŸºäºTDDçš„å¢é‡ç”Ÿæˆä»£ç ]
```

## ğŸ“‹ TASK WORKFLOW (MUST FOLLOW)

### 1) Kickoff & Intent Sync
- Summarize what just happened and what you will do next in 1â€“2 sentences.
- Call interactive-feedback tool when starting substantial tasks or when context changes significantly.

### ğŸ” Discovery First (MANDATORY SEQUENCE - ä¸ƒé‡çˆ†é›·ç‰ˆ)
- **Step 1**: Load project development rules (doc/é¡¹ç›®å¼€å‘è§„èŒƒæ€»è§ˆ.md) - ç†è§£æœ€æ–°è§„èŒƒï¼ˆå«TDDé“å¾‹ï¼‰
- **Step 2**: Serenaé¡¹ç›®åˆ†æ - æ·±åº¦ç†è§£é¡¹ç›®ç°æœ‰åŠŸèƒ½å®ç°æ¨¡å¼ï¼ˆå«TDDå®è·µï¼‰
- **Step 3**: å¢é‡åˆ†æç°æœ‰ä»£ç  - tools/incremental-generation/scripts/analyze-codebase.jsï¼ˆTDDéµå¾ªç‡åˆ†æï¼‰
- **Step 4**: è´¨é‡é—¨æ§æ£€æŸ¥ - tools/quality-assurance/quality-gates.jsï¼ˆTDDå¼ºåˆ¶éªŒè¯ï¼‰
- **Step 5**: ADRå†³ç­–æŸ¥è¯¢ - æœç´¢ç›¸å…³æ¶æ„å†³ç­–ï¼ˆå«TDDæ¶æ„å†³ç­–ï¼‰
- **Step 6**: æ¨¡æ¿åŒ¹é… - åŸºäºä¸ƒé‡åˆ†æç»“æœé€‰æ‹©æœ€ä½³æ¨¡æ¿ï¼ˆä¼˜å…ˆTDDå‹å¥½æ¨¡æ¿ï¼‰
- **Step 7**: ç”Ÿæˆç¬¦åˆä¸ƒé‡çˆ†é›·æ ‡å‡†ä¸”æ»¡è¶³TDDè¦æ±‚çš„å®Œç¾ä»£ç 

### 3) Plan Before Edit
- Use sequential thinking to sketch steps, risks, and verification points.
- Present a brief plan to the user; proceed unless blocked (assume autonomy if no response).

### 4) Todo & Status Discipline
- Maintain a todo list for multi-step work. Mark one item in_progress at a time.
- Provide brief status updates before tool calls and before finishing each turn.

### 5) Editing Rules
- **Code Style Compliance**: Follow project standards (double quotes, no semicolons, 100 char width)
- **TypeScript Standards**: Use strict mode, proper typing, avoid `any`
- **Vue 3 Standards**: Use Composition API, `<script setup>`, proper reactivity
- **Element Plus Integration**: Use proper component imports and theming
- **ABP Framework**: Follow ABP conventions for services, DTOs, permissions
- Only edit what's necessary. Preserve existing indentation and formatting.
- For new code, add imports/types/deps so it runs immediately.

### 6) Quality Gates (MUST run or propose commands - TDDå¼ºåˆ¶æ‰§è¡Œ)
- **Type check**: `npm run type-check` (or `tsc --noEmit`)
- **Lint**: `npm run lint --fix` (don't silence rules; fix root causes)
- **TDDéªŒè¯**: `npm run test:coverage -- --tdd-enforcement=true` (TDDéµå¾ªç‡â‰¥90%)
- **æµ‹è¯•è¦†ç›–ç‡**: `npm run test:coverage` (è¦†ç›–ç‡â‰¥80%)
- **Build**: `npm run build`
- **TDDæ£€æŸ¥**: `npm run test:tdd-compliance` (æ–°å¢TDDåˆè§„æ£€æŸ¥)
- If any gate fails, fix before proceeding. On third failed attempt, ask user.

### 7) Commands & Tools
- Propose shell commands with non-interactive flags; assume no manual input.
- Long-running tasks should run in background.
- Prefer semantic code search for meaning; use grep for exact tokens.

### 8) Documentation Hygiene
- If rules/architecture/process change, update doc/é¡¹ç›®ç¼–ç¨‹è§„åˆ™.md.
- When adding/updating features, adjust or add minimal docs and examples.

### 9) Communication & Output Style
- Be concise and skimmable. Use short sections and bullets.
- Show only relevant code snippets. For existing code, cite with path.
- Provide short end-of-turn summary of what changed and its impact.

### 10) Security & Compliance
- Never embed secrets. Use project logging adapter instead of console.* in production.
- Do not bypass sandbox/safety checks for SFC preview in production.

### 11) Backend/Frontend Contract
- Keep permission names, route names, and policies consistent across backend and frontend.
- Use DTOs with consistent paging/sorting fields.

## ğŸ¯ FRAMEWORK-SPECIFIC GUIDELINES

### Vue 3 + TypeScript Standards
- **Composition API**: Always use `<script setup>` syntax
- **Reactivity**: Use `ref()`, `reactive()`, `computed()` appropriately
- **Props**: Define with `defineProps<T>()` with TypeScript interfaces
- **Emits**: Define with `defineEmits<T>()` with proper typing
- **Stores**: Use Pinia with TypeScript, follow naming convention `use{Entity}Store`
- **Components**: Use PascalCase for component names, kebab-case for file names

### Element Plus Integration
- **Import Strategy**: Use auto-import from unplugin-vue-components
- **Theming**: Follow project's design tokens and CSS variables
- **Icons**: Use `@element-plus/icons-vue` with proper tree-shaking
- **Form Validation**: Use Element Plus form validation with TypeScript

### ABP Framework Standards
- **Services**: Inherit from `SmartAbpAppService`, use `IRepository<T>`
- **DTOs**: Follow naming convention: `{Entity}Dto`, `Create{Entity}Dto`, `Update{Entity}Dto`
- **Permissions**: Use consistent permission names across backend/frontend
- **Localization**: Use ABP localization system for all user-facing text

### Low-code Engine Standards
- **Plugins**: Implement `metadata`, `canHandle`, `validate`, `generate` methods
- **Runtime**: Use sandbox execution (iframe/Worker + CSP) for dev preview
- **Generated Files**: Include "// AUTO-GENERATED FILE â€“ DO NOT EDIT." banner
- **Monitoring**: Use kernel logging/monitoring/cache systems

## ğŸš¨ VIOLATION CONSEQUENCES (AUTOMATIC REJECTION)

**The following actions will result in AUTOMATIC CODE REJECTION:**
- âŒ Skipping template search when templates exist
- âŒ Writing code from scratch when relevant templates available
- âŒ Ignoring ADR decisions and architectural constraints
- âŒ Not following project code style standards
- âŒ Using single quotes instead of double quotes
- âŒ Adding semicolons when project uses no-semicolon style
- âŒ Exceeding 100 character line width
- âŒ Using `any` type without justification
- âŒ Not implementing proper TypeScript interfaces
- âŒ Ignoring Vue 3 Composition API standards
- âŒ Breaking Element Plus component integration
- âŒ Not following ABP framework conventions
- âŒ Bypassing quality gates (type-check, lint, test, build)
- âŒ **è·³è¿‡TDDæµç¨‹ - ä»£ç è´¨é‡ä¸‹é™ï¼ŒåæœŸè°ƒè¯•æˆæœ¬æ¿€å¢ï¼ˆæ–°å¢TDDé“å¾‹ï¼‰**

## ğŸ¯ SUCCESS METRICS

**AI Performance Targets:**
- **Template Usage Rate**: >90% for standard scenarios
- **Code Generation Accuracy**: >95% first-time compilation success
- **ADR Compliance**: 100% adherence to architectural decisions
- **Quality Gate Pass Rate**: >90% without manual intervention
- **Code Style Compliance**: 100% adherence to project standards
- **TDDéµå¾ªç‡**: â‰¥90% for new features (TDDå¼ºåˆ¶æ‰§è¡Œ)
- **Test Coverage**: Maintain >80% coverage for new code
- **Build Success**: 100% successful builds after code generation

---

**ğŸ¯ SUMMARY: Template library rules, ADR compliance, incremental generation, TDDé“å¾‹å¼ºåˆ¶æ‰§è¡Œ, and framework-specific standards are MANDATORY and NON-NEGOTIABLE. AI must demonstrate template usage, ADR alignment, code style compliance, TDDéµå¾ªç‡â‰¥90%, and quality gate validation in every code generation task. Failure to follow these rules constitutes a violation of project standards.**