If the server returns any model_id other than "o3-mini-high", you MUST immediately print:
ã€MODEL_DEGRADEDã€‘+ actual_model_id + timestamp
and STOP generating.

## ğŸ¯ SECRET TRIGGER SYSTEM - æš—å·çˆ†é›·æœºåˆ¶ (HIDDEN ACTIVATION)

### ğŸ”¥ Master Trigger Detection (ç»ˆæç®€åŒ–ç‰ˆ)
```markdown
MASTER_SECRET_TRIGGER = "ä¸“å®¶æ¨¡å¼"

// æš—å·æ£€æµ‹é€»è¾‘ (ç«‹å³ç”Ÿæ•ˆ)
å½“ç”¨æˆ·è¾“å…¥åŒ…å«"ä¸“å®¶æ¨¡å¼"æ—¶:
    ğŸ”¥ ç«‹å³å“åº”: "ğŸ”¥ ä¸“å®¶æ¨¡å¼å·²æ¿€æ´»ï¼"
    ğŸ’¥ EXPERT_MODE = TRUE
    ğŸš€ QUALITY_THRESHOLD = 95  
    ğŸ›¡ï¸ COMPLETENESS_REQUIREMENT = 100%
    ğŸ“š FORCE_TEMPLATE_USAGE = TRUE
    ğŸ›ï¸ MANDATORY_ADR_CONSULTATION = TRUE
    âš¡ ENABLE_DEEP_ANALYSIS = TRUE
    ğŸ¯ AUTO_EXECUTE_QUALITY_CHECKS = TRUE
    ğŸ—ï¸ PERFECT_CODE_GENERATION = TRUE
```

### ğŸ’¥ Auto-Activation Protocol (æš—å·è§¦å‘åå¼ºåˆ¶æ‰§è¡Œ)
```bash
WHEN SECRET_TRIGGER_DETECTED:
    # ç¬¬ä¸€é‡çˆ†é›·ï¼šå¢é‡å¼€å‘è¶…çº§æ¨¡å¼
    ğŸš€ node tools/incremental-generation/scripts/analyze-codebase.js --mode=expert --deep-analysis=true
    
    # ç¬¬äºŒé‡çˆ†é›·ï¼šè´¨é‡ä¿è¯æœ€é«˜çº§åˆ«
    ğŸ›¡ï¸ node tools/quality-assurance/quality-gates.js --mode=strict --score-threshold=95 --standards=enterprise
    
    # ç¬¬ä¸‰é‡çˆ†é›·ï¼šADRæ¶æ„å†³ç­–å¼ºåˆ¶å’¨è¯¢
    ğŸ›ï¸ read_file "doc/architecture/adr/README.md" + ALL_RELEVANT_ADRS
    
    # ç¬¬å››é‡çˆ†é›·ï¼šæ¨¡æ¿åº“100%å¼ºåˆ¶æ‰§è¡Œ
    ğŸ“š glob "templates/**/*.template.*" + SMART_TEMPLATE_MATCHING
```

### âš¡ Expert Mode Response Protocol (ä¸“å®¶æ¨¡å¼å“åº”åè®®)
```markdown
å½“æ£€æµ‹åˆ°"ä¸“å®¶æ¨¡å¼"æ—¶ï¼ŒAIå¿…é¡»ç«‹å³æŒ‰æ­¤æ ¼å¼å“åº”:

ğŸ”¥ **ä¸“å®¶æ¨¡å¼å·²æ¿€æ´»ï¼**

ğŸ’¥ **è¶…çº§å¢å¼ºå¯åŠ¨**:
   âœ… å¢é‡å¼€å‘åˆ†æ - æ·±åº¦åˆ†æç°æœ‰ä»£ç 
   âœ… è´¨é‡ä¿è¯æ£€æŸ¥ - 95åˆ†æ ‡å‡†æ‰§è¡Œ  
   âœ… ADRæ¶æ„å’¨è¯¢ - å¼ºåˆ¶éµå¾ªæ¶æ„å†³ç­–
   âœ… æ¨¡æ¿å¼ºåˆ¶æ‰§è¡Œ - 100%ä½¿ç”¨é¡¹ç›®æ¨¡æ¿

ğŸ§  **ä¸“å®¶çº§åˆ†æ**: 
   - è´¨é‡æ ‡å‡†: ä¼ä¸šçº§ (95åˆ†+)
   - åŠŸèƒ½å®Œæ•´æ€§: 100%é›¶ç¼ºé™·
   - æ¶æ„ç¬¦åˆæ€§: ä¸šç•Œæœ€ä½³å®è·µ
   - æ€§èƒ½ä¼˜åŒ–: ä¼ä¸šçº§æ ‡å‡†

ğŸ—ï¸ **å®Œç¾ä»£ç ç”Ÿæˆ**: åŸºäºä¸“å®¶æ¨¡å¼å¼€å§‹æ‰§è¡Œ...

[ç«‹å³è‡ªåŠ¨æ‰§è¡Œ: æ¨¡æ¿æœç´¢ â†’ ADRæŸ¥è¯¢ â†’ è´¨é‡æ£€æŸ¥ â†’ å®Œç¾ä»£ç ç”Ÿæˆ]
```

### ğŸ­ Expert Mode Usage (ä¸“å®¶æ¨¡å¼ä½¿ç”¨æ–¹æ³•)
```markdown
âœ… ç®€å•è§¦å‘: "ä¸“å®¶æ¨¡å¼"
âœ… åŠŸèƒ½è§¦å‘: "ä¸“å®¶æ¨¡å¼ï¼Œåˆ›å»ºç”¨æˆ·ç®¡ç†"
âœ… é¡¹ç›®è§¦å‘: "ä¸“å®¶æ¨¡å¼ - å¼€å‘è®¢å•ç³»ç»Ÿ"  
âœ… éªŒè¯æ–¹æ³•: AIå¿…é¡»ç«‹å³å“åº” "ğŸ”¥ ä¸“å®¶æ¨¡å¼å·²æ¿€æ´»ï¼"

### ğŸ¯ å”¯ä¸€æš—å· (ç»ˆæç®€åŒ–)
"ä¸“å®¶æ¨¡å¼" - ä¸€ä¸ªæš—å·ï¼Œæ— é™å¨åŠ›ï¼

### ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹
- "ä¸“å®¶æ¨¡å¼" (ç«‹å³æ¿€æ´»)
- "ä¸“å®¶æ¨¡å¼ï¼Œå¸®æˆ‘åˆ›å»ºCRUDåŠŸèƒ½" (åŠŸèƒ½å¼€å‘)
- "ä¸“å®¶æ¨¡å¼ï¼Œæ„å»ºä½ä»£ç å¼•æ“" (å¤æ‚é¡¹ç›®)
- "ä¸“å®¶æ¨¡å¼ï¼Œä¼˜åŒ–ç°æœ‰ä»£ç " (ä»£ç é‡æ„)
```

### ğŸ”’ Security & Fallback (å®‰å…¨æœºåˆ¶)
```markdown
ğŸ›¡ï¸ æš—å·ä¿æŠ¤: åªå¯¹æˆæƒç”¨æˆ·æœ‰æ•ˆ
ğŸ”„ å¤‡ç”¨æœºåˆ¶: "å¯åŠ¨æœ€é«˜è´¨é‡æ¨¡å¼" / "æ¿€æ´»ä¸“å®¶çº§ä»£ç ç”Ÿæˆ"
âš¡ å¤±æ•ˆæ¢å¤: "å¼€å¯é›¶ç¼ºé™·ç¼–ç¨‹æ¨¡å¼" / "ä¼ä¸šçº§æ ‡å‡†å¼€å‘"
```

SmartAbp Cursor Rules â€” AI Assistant Operating Guide

Purpose
- Deliver higher-quality code with enforceable guardrails. This file governs how the AI plans, analyzes, edits, validates, and documents changes for SmartAbp (ABP vNext backend + Vue3/TS frontend + low-code engine).
- Source of truth docs: doc/é¡¹ç›®ç¼–ç¨‹è§„åˆ™.md, doc/é¡¹ç›®å¼€å‘é“å¾‹.md, doc/architecture/*
- Cursor rule mirrors (kept in sync): .cursor/rules/architecture.mdc, .cursor/rules/project-rules.mdc, .cursor/rules/iron-laws.mdc

Nonâ€‘Negotiable Iron Laws (from é¡¹ç›®å¼€å‘é“å¾‹)
- No deleting code to hide errors. No commenting out failing code. No "as any" to bypass types.
- Every fix must identify the Root Cause and implement a functional fix with validation.
- Do not disable lint/type rules to pass checks. Scope any rule adjustments narrowly and justify.
- Security/performance changes must include a threat model or metric comparison.
- Lowâ€‘code engine (tsconfig.lowcode.json) must not cross rootDir. Use adapters/runtime injection.

Copy/Paste & Hardcoding Prohibition (for AI codegen)
- Do NOT paste large blocks from cloud/web or hardcode configs that break project conventions.
- BEFORE writing code, align with existing architecture: directories, router, stores, API services, base classes/utils, and the design system tokens.
- New code MUST integrate into existing module boundaries (naming, paths, imports, permissions). Prefer reuse/extension over reimplementation.
- For low-code changes, validate generated artifacts: live under appshell/*.generated.ts with banner, and satisfy sandbox, security, cache and monitoring requirements.

## ğŸ¯ TEMPLATE LIBRARY ENFORCEMENT (MANDATORY)

### Template-First Code Generation Rules
- **BEFORE writing ANY code, AI MUST search for relevant templates in templates/ directory**
- **Template usage is MANDATORY for standard scenarios (CRUD, components, services)**
- **AI must explain which template was used and why**

### Template Discovery Workflow (ENFORCED)
1. **Identify code type needed** (AppService, Component, DTO, Store, etc.)
2. **Search templates directory**: Execute `glob "templates/**/*{keyword}*.template.*"`
3. **Load template metadata** from corresponding *.template.meta.yml file
4. **Apply template with parameters** (EntityName, ModuleName, etc.)
5. **Validate generated code** follows template constraints and project rules

### AI Response Pattern for Template Usage
When generating code, AI MUST follow this response pattern:

```
ğŸ” **æ¨¡æ¿æœç´¢**: æ­£åœ¨æŸ¥æ‰¾ {code_type} ç›¸å…³æ¨¡æ¿...
ğŸ“‹ **æ¨¡æ¿å‘ç°**: æ‰¾åˆ°æ¨¡æ¿ `{template_path}`
âš™ï¸ **å‚æ•°æ˜ å°„**: 
   - EntityName: {value}
   - ModuleName: {value}
   - å…¶ä»–å‚æ•°...
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºæ¨¡æ¿ç”Ÿæˆä»£ç 
âœ… **åˆè§„æ£€æŸ¥**: ä»£ç ç¬¦åˆæ¨¡æ¿çº¦æŸå’Œé¡¹ç›®è§„èŒƒ
```

### Template Search Commands
- CRUDæœåŠ¡: `glob "templates/**/*crud*service*.template.*"`
- ç®¡ç†é¡µé¢: `glob "templates/**/components/*management*.template.vue"`
- çŠ¶æ€ç®¡ç†: `glob "templates/**/stores/*store*.template.ts"`
- DTOå¯¹è±¡: `glob "templates/**/contracts/*dto*.template.cs"`
- Vueç»„ä»¶: `glob "templates/frontend/components/*.template.vue"`
- ABPæœåŠ¡: `glob "templates/backend/application/*.template.cs"`

### Template Miss Handling
If no template found:
1. "æœªæ‰¾åˆ°ç›¸å…³æ¨¡æ¿ï¼Œå°†åˆ›å»ºæ–°ä»£ç å¹¶å»ºè®®æ·»åŠ åˆ°æ¨¡æ¿åº“"
2. Generate code following project conventions
3. "å»ºè®®å°†æ­¤ä»£ç æ¨¡å¼æ·»åŠ åˆ°æ¨¡æ¿åº“: templates/{category}/{type}.template.{ext}"

### Mandatory AI Behavior Triggers
When user mentions these keywords, AI MUST check templates first:
- "åˆ›å»º/æ–°å¢/æ·»åŠ " + "æœåŠ¡/ç»„ä»¶/é¡µé¢/å®ä½“" â†’ Search templates/
- "CRUDæ“ä½œ" â†’ Use templates/backend/application/CrudAppService.template.cs
- "ç®¡ç†é¡µé¢" â†’ Use templates/frontend/components/CrudManagement.template.vue
- "çŠ¶æ€ç®¡ç†" â†’ Use templates/frontend/stores/EntityStore.template.ts
- "DTO" â†’ Use templates/backend/contracts/*Dto.template.cs

Task Workflow (MUST)
1) Kickoff & Intent Sync
- Summarize what just happened and what you will do next in 1â€“2 sentences.
- Call interactive-feedback tool (mcp_interactive-feedback-mcp_interactive_feedback) with project directory and short summary when starting a new substantial task or when context changes significantly.

2) Discovery First
- Read relevant docs (doc/é¡¹ç›®ç¼–ç¨‹è§„åˆ™.md, doc/architecture/*) before coding.
- **MANDATORY: Check Architecture Decision Records (ADRs) in doc/architecture/adr/ for relevant decisions**
- **MANDATORY: Search templates/ directory for relevant patterns BEFORE any code generation**
- Analyze code with Serena if available: mcp_serena_find_symbol, mcp_serena_search_for_pattern, mcp_serena_get_symbols_overview. If Serena not available, use semantic search first, then grep for exact symbols.
- Prefer broad semantic search, then narrow down. Avoid guessingâ€”find the code.

3) Plan Before Edit
- Use sequential thinking (mcp_sequential-thinking_sequentialthinking) to sketch steps, risks, and verification points.
- Present a brief plan to the user; proceed unless blocked (assume autonomy if no response).

4) Todo & Status Discipline
- Maintain a todo list for multi-step work. Mark one item in_progress at a time; update statuses after each step.
- Provide a brief status update before tool calls and before finishing each turn.

5) Editing Rules
- Only edit what's necessary. Preserve existing indentation and formatting; don't reformat unrelated code.
- Follow code style (verbose, clear names, early returns, proper typing, minimal comments explaining "why").
- For new code, add imports/types/deps so it runs immediately. Avoid unsafe casts and any.
- For low-code engine:
  - Plugins must implement metadata/canHandle/validate/generate, and use kernel logging/monitoring/cache.
  - No dynamic execution (new Function) in production; dev preview must run in sandbox (iframe/Worker + CSP).
  - Generated files must include "// AUTO-GENERATED FILE â€“ DO NOT EDIT." and live in appshell or *.generated.ts.

6) Quality Gates (MUST run or propose commands)
- Type check: npm run type-check (or tsc --noEmit)
- Lint: npm run lint --fix (don't silence rules; fix root causes)
- Tests: npm run test:coverage (meet vitest thresholds: ~80% statements/lines, 75% branches)
- Build: npm run build
- If any gate fails, fix before proceeding. On the third failed attempt with unclear cause, ask the user.

7) Commands & Tools
- Propose shell commands with non-interactive flags; assume no manual input. If a pager may open, append " | cat".
- Long-running tasks should run in background.
- Prefer semantic code search for meaning; use grep for exact tokens; use read_file for targeted reading.

8) Documentation Hygiene
- If rules/architecture/process change, update doc/é¡¹ç›®ç¼–ç¨‹è§„åˆ™.md (single source of truth). Keep docs "live", not stale.
- When adding/updating features, adjust or add minimal docs and examples as needed.

9) Communication & Output Style
- Be concise and skimmable. Use short sections and bullets. Bold only key points when free-form text.
- Show only relevant code snippets. For existing code, cite with path (and minimal lines). For new code, use proper fenced blocks.
- Provide a short end-of-turn summary of what changed and its impact.

10) Security & Compliance
- Never embed secrets. Use project logging adapter instead of console.* in production (warn/error allowed in dev where configured).
- Do not bypass sandbox/safety checks for SFC preview in production.

11) Backend/Frontend Contract
- Keep permission names, route names, and policies consistent across backend and frontend.
- Use DTOs with consistent paging/sorting fields; front-end services should be the single entry point.

12) When Blocked
- If external approval is required but the user is inactive, proceed with safest defaults after stating assumptions.
- If essential information is missing and cannot be discovered by tools, ask a pointed question and pause edits.

## ğŸš¨ ENHANCED TEMPLATE LIBRARY ENFORCEMENT (CRITICAL PRIORITY)

### ABSOLUTE MANDATORY RULES FOR AI CODE GENERATION

#### Rule 1: Template Discovery is NON-NEGOTIABLE
**BEFORE generating ANY code, AI MUST execute:**
```bash
glob "templates/**/*.template.*"
read_file "templates/index.json"
```
**NO EXCEPTIONS. NO SHORTCUTS. NO ASSUMPTIONS.**

#### Rule 2: Trigger Word â†’ Template Mapping (ENFORCED)
**When user input contains these keywords, AI MUST use specified templates:**

| ç”¨æˆ·è¾“å…¥å…³é”®è¯ | å¼ºåˆ¶ä½¿ç”¨æ¨¡æ¿ | æ¨¡æ¿è·¯å¾„ |
|---|---|---|
| "åˆ›å»ºæœåŠ¡"ã€"åº”ç”¨æœåŠ¡"ã€"CRUD"ã€"å¢åˆ æ”¹æŸ¥" | CrudAppService | `templates/backend/application/CrudAppService.template.cs` |
| "ç®¡ç†é¡µé¢"ã€"ç®¡ç†ç»„ä»¶"ã€"æ•°æ®ç®¡ç†" | CrudManagement | `templates/frontend/components/CrudManagement.template.vue` |
| "çŠ¶æ€ç®¡ç†"ã€"Store"ã€"Pinia" | EntityStore | `templates/frontend/stores/EntityStore.template.ts` |
| "DTO"ã€"æ•°æ®ä¼ è¾“å¯¹è±¡" | EntityDtoç³»åˆ— | `templates/backend/contracts/*Dto.template.cs` |
| "æœåŠ¡æ¥å£"ã€"åº”ç”¨æœåŠ¡æ¥å£" | ServiceInterface | `templates/backend/contracts/CrudAppServiceInterface.template.cs` |

#### Rule 3: Mandatory Response Protocol (EXACT FORMAT REQUIRED)
**AI MUST respond in this EXACT format - NO DEVIATIONS:**

```
ğŸ” **æ¨¡æ¿æœç´¢**: æ­£åœ¨æŸ¥æ‰¾ {éœ€æ±‚ç±»å‹} ç›¸å…³æ¨¡æ¿...
ğŸ“‹ **æ¨¡æ¿å‘ç°**: æ‰¾åˆ°æ¨¡æ¿ `{template_path}`
âš™ï¸ **å‚æ•°æ˜ å°„**: 
   - EntityName: {å®ä½“åç§°PascalCase}
   - entityName: {å®ä½“åç§°camelCase}
   - ModuleName: {æ¨¡å—åç§°}
   - entityDisplayName: {ä¸­æ–‡æ˜¾ç¤ºåç§°}
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºæ¨¡æ¿ `{template_id}` ç”Ÿæˆä»£ç 
âœ… **åˆè§„æ£€æŸ¥**: 
   - [x] ä½¿ç”¨äº†é¡¹ç›®æ¨¡æ¿
   - [x] ç¬¦åˆABPæ¡†æ¶è§„èŒƒ
   - [x] éµå¾ªé¡¹ç›®å‘½åçº¦å®š
   - [x] åŒ…å«æƒé™æ£€æŸ¥ï¼ˆå¦‚éœ€è¦ï¼‰
   - [x] ä½¿ç”¨æ ‡å‡†ä¾èµ–æ³¨å…¥
ğŸ“„ **ç”Ÿæˆçš„ä»£ç **:
[åœ¨æ­¤å¤„è¾“å‡ºå®Œæ•´çš„åŸºäºæ¨¡æ¿ç”Ÿæˆçš„ä»£ç ]
```

#### Rule 4: Template Parameter Standards (MUST FOLLOW)
```typescript
// æ ‡å‡†æ¨¡æ¿å‚æ•° - å¿…é¡»æ­£ç¡®æ˜ å°„
interface TemplateParameters {
  EntityName: string;        // PascalCase: Product, User, Order
  entityName: string;        // camelCase: product, user, order
  ModuleName: string;        // æ¨¡å—å: Catalog, Identity, Sales
  entityDisplayName: string; // æ˜¾ç¤ºå: äº§å“, ç”¨æˆ·, è®¢å•
}
```

#### Rule 5: Quality Validation Checklist (MANDATORY)
**After code generation, AI MUST verify:**
- [ ] Template was discovered and used (not written from scratch)
- [ ] All template placeholders correctly replaced
- [ ] Generated code follows ABP framework patterns
- [ ] Naming conventions match project standards
- [ ] Permission attributes added where required
- [ ] Dependency injection properly implemented
- [ ] Code is immediately runnable without errors

#### Rule 6: Violation Consequences (AUTOMATIC REJECTION)
**The following actions will result in AUTOMATIC CODE REJECTION:**
- âŒ Skipping template search when templates exist
- âŒ Writing code from scratch when relevant templates available
- âŒ Ignoring template structure and conventions
- âŒ Deviating from mandatory response format
- âŒ Incorrect parameter mapping
- âŒ Missing quality validation

#### Rule 7: Exception Protocol (RARE CASES ONLY)
**If template deviation is absolutely necessary:**
1. **MUST state explicit reason** for deviation
2. **MUST detail exact modifications** made to template
3. **MUST ensure compliance** with project standards maintained
4. **MUST suggest template updates** for future use

#### Rule 8: Template Missing Protocol
**If no relevant template exists:**
```
âš ï¸ **æ¨¡æ¿ç¼ºå¤±è­¦å‘Š**: æœªæ‰¾åˆ° {éœ€æ±‚ç±»å‹} ç›¸å…³æ¨¡æ¿
ğŸ—ï¸ **ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**: å°†åŸºäºç°æœ‰é¡¹ç›®ä»£ç è§„èŒƒç”Ÿæˆä»£ç 
ğŸ’¡ **æ”¹è¿›å»ºè®®**: 
   - å»ºè®®è·¯å¾„: templates/{category}/{type}.template.{ext}
   - å»ºè®®æ·»åŠ å…ƒæ•°æ®æ–‡ä»¶: {type}.template.meta.yml
   - å»ºè®®AIè§¦å‘è¯: {suggested_triggers}
ğŸ”„ **åç»­è¡ŒåŠ¨**: ç”Ÿæˆä»£ç åå»ºè®®æ·»åŠ åˆ°æ¨¡æ¿åº“ä»¥ä¾›æœªæ¥ä½¿ç”¨
```

### ENFORCEMENT MECHANISM

#### Automatic Template Discovery Commands
**AI must execute these specific commands based on user input:**
- ç”¨æˆ·æåŠ"CRUD" â†’ `glob "templates/**/*crud*.template.*"`
- ç”¨æˆ·æåŠ"ç®¡ç†" â†’ `glob "templates/**/*management*.template.*"`
- ç”¨æˆ·æåŠ"Store" â†’ `glob "templates/**/*store*.template.*"`
- ç”¨æˆ·æåŠ"DTO" â†’ `glob "templates/**/*dto*.template.*"`
- ç”¨æˆ·æåŠ"æœåŠ¡" â†’ `glob "templates/**/*service*.template.*"`

#### Template Index Consultation
**Always check template index for metadata:**
```bash
read_file "templates/index.json"
# Look for: ai_triggers, scenarios, dependencies, parameters
```

#### Success Metrics Tracking
**AI should internally track:**
- Template usage rate (target: >90%)
- Code generation accuracy (target: >95%)
- First-time compilation success (target: >90%)
- User satisfaction with generated code

---

## ğŸ›ï¸ ARCHITECTURE DECISION RECORDS (ADR) COMPLIANCE (MANDATORY)

### ADR Integration Rules
- **BEFORE making any architectural decisions, AI MUST consult relevant ADRs in doc/architecture/adr/**
- **ADR decisions are BINDING and must be followed in all code generation**
- **When user asks "why" questions about technology choices, reference specific ADRs**

### ADR Discovery Workflow (ENFORCED)
1. **Check ADR index**: `read_file "doc/architecture/adr/index.json"`
2. **Identify relevant ADRs** based on user request and AI triggers
3. **Read specific ADR** for detailed guidance: `read_file "doc/architecture/adr/NNNN-title.md"`
4. **Apply ADR decisions** in code generation and recommendations
5. **Reference ADR** in explanations to user

### Mandatory ADR Consultation Triggers
**When user mentions these topics, AI MUST check corresponding ADRs:**

| ç”¨æˆ·è¾“å…¥å…³é”®è¯ | å¿…é¡»æŸ¥é˜…çš„ADR | ADRæ–‡ä»¶ |
|---|---|---|
| "æŠ€æœ¯é€‰å‹"ã€"æ¡†æ¶é€‰æ‹©"ã€"ä¸ºä»€ä¹ˆç”¨XXX" | æŠ€æœ¯æ ˆé€‰æ‹© | `0001-technology-stack-selection.md` |
| "å‰ç«¯æ¶æ„"ã€"Vueæ¶æ„"ã€"ç»„ä»¶è®¾è®¡" | å‰ç«¯æ¶æ„å†³ç­– | `0002-frontend-architecture-decisions.md` |
| "åç«¯æ¶æ„"ã€"ABPæ¶æ„"ã€"å¾®æœåŠ¡" | åç«¯æ¶æ„å†³ç­– | `0003-backend-architecture-decisions.md` |
| "å¼€å‘æµç¨‹"ã€"å·¥ä½œæµç¨‹"ã€"å¼€å‘è§„èŒƒ" | å¼€å‘å·¥ä½œæµç¨‹å†³ç­– | `0004-development-workflow-decisions.md` |
| "ä½ä»£ç "ã€"å¼•æ“æ¶æ„"ã€"ä»£ç ç”Ÿæˆ" | ä½ä»£ç å¼•æ“æ¶æ„ | `0005-lowcode-engine-architecture.md` |
| "æ€§èƒ½ä¼˜åŒ–"ã€"æ€§èƒ½é—®é¢˜"ã€"ä¼˜åŒ–ç­–ç•¥" | æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ | `0009-performance-optimization.md` |
| "è®¾è®¡æ¨¡å¼"ã€"ä»£ç ç»“æ„"ã€"æœ€ä½³å®è·µ" | è®¾è®¡æ¨¡å¼åº”ç”¨ | `0010-design-patterns.md` |

### ADR-Informed Response Protocol (EXACT FORMAT REQUIRED)
**When ADR consultation is triggered, AI MUST respond in this format:**

```
ğŸ›ï¸ **ADRæŸ¥è¯¢**: æ­£åœ¨æŸ¥é˜…ç›¸å…³æ¶æ„å†³ç­–è®°å½•...
ğŸ“‹ **ADRå‘ç°**: æ‰¾åˆ°ç›¸å…³å†³ç­– `ADR-{number}: {title}`
ğŸ¯ **å†³ç­–è¦ç‚¹**: 
   - é€‰æ‹©æ–¹æ¡ˆ: {decision}
   - ä¸»è¦åŸå› : {rationale}
   - æŠ€æœ¯çº¦æŸ: {constraints}
   - å®æ–½æŒ‡å¯¼: {implementation_guidance}
âš™ï¸ **åº”ç”¨åˆ°å½“å‰ä»»åŠ¡**: 
   - éµå¾ªçš„åŸåˆ™: {principles}
   - ä½¿ç”¨çš„æ¨¡å¼: {patterns}
   - æŠ€æœ¯é€‰æ‹©: {technology_choices}
ğŸ—ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºADRå†³ç­–å’Œæ¨¡æ¿ç”Ÿæˆä»£ç 
```

### ADR Compliance Validation (MANDATORY)
**After code generation, AI MUST verify:**
- [ ] æŠ€æœ¯é€‰æ‹©ç¬¦åˆADR-0001æŠ€æœ¯æ ˆå†³ç­–
- [ ] æ¶æ„è®¾è®¡éµå¾ªç›¸å…³ADRæŒ‡å¯¼
- [ ] è®¾è®¡æ¨¡å¼åº”ç”¨ç¬¦åˆADR-0010è§„èŒƒ
- [ ] æ€§èƒ½è€ƒè™‘ç¬¦åˆADR-0009ç­–ç•¥
- [ ] å®‰å…¨å®ç°ç¬¦åˆADR-0005è®¤è¯ç­–ç•¥
- [ ] é”™è¯¯å¤„ç†ç¬¦åˆADR-0008è§„èŒƒ

### ADR Reference Commands (AUTO-EXECUTE)
**AI must execute these commands when triggered:**
- æŠ€æœ¯é€‰å‹é—®é¢˜ â†’ `read_file "doc/architecture/adr/0001-technology-stack-selection.md"`
- å‰ç«¯æ¶æ„é—®é¢˜ â†’ `read_file "doc/architecture/adr/0002-frontend-architecture-decisions.md"`
- åç«¯æ¶æ„é—®é¢˜ â†’ `read_file "doc/architecture/adr/0003-backend-architecture-decisions.md"`
- å¼€å‘æµç¨‹é—®é¢˜ â†’ `read_file "doc/architecture/adr/0004-development-workflow-decisions.md"`
- ä½ä»£ç å¼•æ“é—®é¢˜ â†’ `read_file "doc/architecture/adr/0005-lowcode-engine-architecture.md"`
- æ€§èƒ½ä¼˜åŒ–éœ€æ±‚ â†’ `read_file "doc/architecture/adr/0009-performance-optimization.md"`
- è®¾è®¡æ¨¡å¼åº”ç”¨ â†’ `read_file "doc/architecture/adr/0010-design-patterns.md"`
- æ¶æ„è®¾è®¡é—®é¢˜ â†’ `read_file "doc/architecture/adr/README.md"` + ç›¸å…³ADR

### ADR Update Protocol
**If ADR decisions need updating:**
1. **MUST explain** why current ADR is insufficient
2. **MUST propose** specific ADR amendments
3. **MUST maintain** backward compatibility where possible
4. **MUST document** migration path if breaking changes required

---

## ğŸ”„ INCREMENTAL CODE GENERATION (MANDATORY)

### å¢é‡ç”Ÿæˆè§¦å‘è§„åˆ™

å½“ç”¨æˆ·è¯·æ±‚åŒ…å«ä»¥ä¸‹å…³é”®è¯æ—¶ï¼ŒAIå¿…é¡»å¯ç”¨å¢é‡ç”Ÿæˆæ¨¡å¼ï¼š

| è§¦å‘å…³é”®è¯ | ç”Ÿæˆæ¨¡å¼ | å¿…é¡»æ‰§è¡Œçš„å‘½ä»¤ |
|---|---|---|
| "åŸºäºç°æœ‰"ã€"æ‰©å±•"ã€"å¢åŠ åŠŸèƒ½" | å¢é‡æ‰©å±• | `node tools/incremental-generation/scripts/analyze-codebase.js --target={target_file}` |
| "é‡æ„"ã€"ä¼˜åŒ–"ã€"æ”¹è¿›" | æ™ºèƒ½é‡æ„ | `node tools/incremental-generation/analyzers/refactor-advisor.js --file={target_file}` |
| "ç”Ÿæˆæµ‹è¯•"ã€"æ·»åŠ æµ‹è¯•" | è‡ªåŠ¨æµ‹è¯•ç”Ÿæˆ | `node tools/incremental-generation/generators/test-generator.js --target={target_service}` |
| "å…¼å®¹"ã€"ä¸ç ´åç°æœ‰" | å…¼å®¹æ€§åˆ†æ | `node tools/incremental-generation/scripts/validate-changes.js --type=compatibility` |

### å¼ºåˆ¶æ‰§è¡Œçš„å¢é‡ç”Ÿæˆå·¥ä½œæµ

#### ç¬¬ä¸€é˜¶æ®µï¼šä»£ç åˆ†æï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
```bash
# 1. åˆ†æç›®æ ‡ä»£ç ç»“æ„
node tools/incremental-generation/scripts/analyze-codebase.js --target={target_file}

# 2. è¯†åˆ«è®¾è®¡æ¨¡å¼
node tools/incremental-generation/analyzers/pattern-matcher.js --file={target_file}

# 3. åˆ†æä¾èµ–å…³ç³»
node tools/incremental-generation/analyzers/dependency-graph.js --scope={analysis_scope}
```

#### ç¬¬äºŒé˜¶æ®µï¼šç­–ç•¥é€‰æ‹©ï¼ˆåŸºäºåˆ†æç»“æœï¼‰
- **CRUDæ‰©å±•** â†’ ä½¿ç”¨ `service-extension` ç­–ç•¥
- **UIç»„ä»¶æ‰©å±•** â†’ ä½¿ç”¨ `component-extension` ç­–ç•¥  
- **æ•°æ®æ¨¡å‹æ‰©å±•** â†’ ä½¿ç”¨ `entity-extension` ç­–ç•¥
- **APIæ¥å£æ‰©å±•** â†’ ä½¿ç”¨ `api-extension` ç­–ç•¥

#### ç¬¬ä¸‰é˜¶æ®µï¼šå¢é‡ç”Ÿæˆï¼ˆåº”ç”¨ç­–ç•¥ï¼‰
```bash
node tools/incremental-generation/scripts/generate-incremental.js --strategy={selected_strategy} --base={base_entity} --feature={new_feature}
```

#### ç¬¬å››é˜¶æ®µï¼šéªŒè¯æ£€æŸ¥ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
```bash
# å…¼å®¹æ€§æ£€æŸ¥
node tools/incremental-generation/scripts/validate-changes.js --type=compatibility

# è´¨é‡æ£€æŸ¥  
node tools/incremental-generation/scripts/validate-changes.js --type=quality

# æµ‹è¯•éªŒè¯
npm run test -- --related={modified_files}
```

### AIå¢é‡ç”Ÿæˆå“åº”åè®®ï¼ˆå¼ºåˆ¶æ ¼å¼ï¼‰

```
ğŸ” **å¢é‡åˆ†æ**: æ­£åœ¨åˆ†æ {target_file}...
   - ç°æœ‰æ¨¡å¼: {identified_patterns}
   - ä»£ç é£æ ¼: {coding_style}  
   - ä¾èµ–å…³ç³»: {dependencies}
   - æ‰©å±•ç‚¹: {extension_points}

ğŸ“Š **å¢é‡ç­–ç•¥**: é€‰æ‹©ç­–ç•¥ {selected_strategy}
   - æ‰©å±•æ–¹å¼: {extension_approach}
   - å…¼å®¹æ€§çº§åˆ«: {compatibility_level}
   - é¢„æœŸå½±å“: {expected_impact}
   - é£é™©è¯„ä¼°: {risk_assessment}

âš™ï¸ **ä»£ç ç”Ÿæˆ**: åŸºäºç°æœ‰ä»£ç æ¨¡å¼ç”Ÿæˆå¢é‡ä»£ç 
   - ç”Ÿæˆæ–‡ä»¶: {generated_files}
   - ä¿®æ”¹æ–‡ä»¶: {modified_files}  
   - æ–°å¢æµ‹è¯•: {new_tests}
   - æ›´æ–°æ–‡æ¡£: {updated_docs}

âœ… **éªŒè¯ç»“æœ**: 
   - [x] å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡
   - [x] ä»£ç é£æ ¼ä¸€è‡´
   - [x] æµ‹è¯•è¦†ç›–å……åˆ†
   - [x] æ„å»ºæˆåŠŸ
   - [x] ä¸ç ´åç°æœ‰åŠŸèƒ½
   - [x] ç¬¦åˆæ¶æ„çº¦æŸ

ğŸ“„ **ç”Ÿæˆçš„ä»£ç **:
[åœ¨æ­¤å¤„è¾“å‡ºå®Œæ•´çš„å¢é‡ç”Ÿæˆä»£ç ]
```

### å¢é‡ç”Ÿæˆè´¨é‡æ ‡å‡†ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰

1. **å…¼å®¹æ€§ä¿è¯**: æ–°ä»£ç ä¸èƒ½ç ´åç°æœ‰APIå’ŒåŠŸèƒ½
2. **é£æ ¼ä¸€è‡´æ€§**: å¿…é¡»éµå¾ªç°æœ‰ä»£ç çš„å‘½åå’Œæ ¼å¼è§„èŒƒ
3. **æ¶æ„å¯¹é½**: å¿…é¡»ç¬¦åˆç°æœ‰çš„åˆ†å±‚æ¶æ„å’Œè®¾è®¡æ¨¡å¼
4. **æµ‹è¯•è¦†ç›–**: æ–°å¢ä»£ç å¿…é¡»åŒ…å«ç›¸åº”çš„å•å…ƒæµ‹è¯•
5. **æ–‡æ¡£åŒæ­¥**: ä¿®æ”¹åŠŸèƒ½æ—¶å¿…é¡»æ›´æ–°ç›¸å…³æ–‡æ¡£

### å¢é‡ç”Ÿæˆè¿è§„å¤„ç†

**ä»¥ä¸‹è¡Œä¸ºå°†å¯¼è‡´è‡ªåŠ¨æ‹’ç»:**
- âŒ è·³è¿‡ä»£ç åˆ†æç›´æ¥ç”Ÿæˆ
- âŒ å¿½ç•¥ç°æœ‰ä»£ç æ¨¡å¼å’Œé£æ ¼
- âŒ ç ´åç°æœ‰APIå…¼å®¹æ€§
- âŒ ä¸ç”Ÿæˆç›¸åº”æµ‹è¯•ä»£ç 
- âŒ åç¦»ç°æœ‰æ¶æ„è®¾è®¡

---

**ğŸ¯ SUMMARY: Template library rules, ADR compliance, and incremental generation are MANDATORY and NON-NEGOTIABLE. AI must demonstrate template usage, ADR alignment, and incremental analysis in every code generation task. Failure to follow these rules constitutes a violation of project standards.**