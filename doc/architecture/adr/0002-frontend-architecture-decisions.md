# ADR-0002: 前端架构决策

## 状态
已接受

## 背景
SmartAbp项目前端采用Vue 3 + TypeScript技术栈，需要建立企业级SaaS前端架构标准，支持模块化开发、代码自动生成和多租户场景。

## 决策

### 核心技术栈
- **框架**: Vue 3 + TypeScript + Composition API
- **构建工具**: Vite (开发服务器端口: 11369)
- **状态管理**: Pinia (组合式API风格)
- **路由**: Vue Router 4
- **UI组件库**: Element Plus
- **HTTP客户端**: 统一使用axios封装

### 目录结构 (Feature-Sliced Design)
```
src/SmartAbp.Vue/src/
├── core/                 # 核心设施层
│   ├── config/          # 运行时配置
│   ├── http/            # HTTP客户端封装
│   ├── auth/            # 认证与多租户
│   ├── i18n/            # 国际化
│   ├── router/          # 路由守卫
│   ├── store/           # Pinia配置
│   └── ui/              # 设计系统适配
├── modules/             # 业务模块
│   ├── system/          # 系统管理模块
│   ├── projects/        # 项目管理模块
│   └── logs/            # 日志管理模块
├── appshell/            # 自动生成的聚合产物
└── lowcode/             # 低代码引擎
```

### 认证与授权策略
- **认证方式**: OpenIddict Password Grant Flow
- **Token存储**: localStorage (可配置为HttpOnly Cookie)
- **多租户**: HTTP头 `__tenant` 自动注入
- **权限控制**: 动态路由 + v-permission指令

### 代码生成支持
- **API客户端**: OpenAPI → TypeScript自动生成
- **模块脚手架**: Plop模板化生成
- **权限路由**: 后端权限树 → 前端动态路由

## 理由

### 技术选型理由
1. **Vue 3 Composition API**: 更好的TypeScript支持，逻辑复用性强
2. **Vite**: 开发体验优秀，构建速度快
3. **Pinia**: 官方推荐，类型安全，支持组合式API
4. **Element Plus**: 企业级组件库，生态完善

### 架构设计理由
1. **Feature-Sliced Design**: 
   - 高内聚低耦合
   - 支持模块独立开发和测试
   - 便于代码自动生成
   
2. **核心设施层分离**:
   - 统一技术标准
   - 减少重复代码
   - 便于维护和升级

3. **动态权限路由**:
   - 与后端权限保持一致
   - 支持多租户场景
   - 便于自动生成

## 后果

### 正面影响
- 代码结构清晰，易于维护
- 支持大规模团队协作
- 便于实现代码自动生成
- 统一的技术标准和规范

### 负面影响
- 学习成本相对较高
- 需要严格遵循架构约定
- 初期搭建复杂度增加

### 风险缓解
- 提供详细的开发文档和示例
- 建立代码审查机制
- 逐步迁移，保持向后兼容

## AI编程指导原则

### 强制要求
1. **必须遵循目录结构**: 新增功能必须放在正确的模块目录下
2. **必须使用核心设施**: 不得绕过core层直接实现HTTP、认证等功能
3. **必须使用TypeScript**: 严格类型检查，避免any类型
4. **必须遵循命名约定**: 组件PascalCase，文件camelCase，常量UPPER_SNAKE_CASE

### 代码生成规则
1. **API调用**: 必须使用自动生成的API客户端
2. **新模块**: 必须使用脚手架模板生成
3. **路由权限**: 必须使用动态权限系统
4. **样式**: 必须使用设计系统Token

### 质量标准
- TypeScript严格模式
- ESLint规则检查
- 单元测试覆盖率 ≥ 80%
- 组件必须有Props类型定义

## 相关文档
- [系统架构说明书](./系统架构说明书.md)
- [前端架构优化建议](./前端架构优化建议.md)
- [项目编程规则](../项目编程规则.md)

## 更新历史
- 2024-01-09: 初始版本，基于现有架构分析