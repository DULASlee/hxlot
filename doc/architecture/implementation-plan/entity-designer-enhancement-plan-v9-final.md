# 低代码引擎开发计划 (V9.3 - 企业级UI增强版)

## 核心架构思想
本计划的核心是**“高质量起点生成”**与**“可视化微调”**的无缝结合，并贯穿**“智能增强”**的能力。

*   **高质量起点生成**: 引擎的核心任务是消费全链路元数据，一键生成**功能完备、样式专业、开箱即用**的企业级应用骨架，包括复杂的UI布局（如主从Tab页）。这为开发者提供了一个“80分”的坚实基础。
*   **可视化微调**: 在高质量起点的基础上，提供一个专业级、所见即所得的**三栏式UI定制器**，让用户通过拖拽和配置，轻松将应用从“80分”优化至“95分”，而无需编写代码。
*   **智能增强**: 在整个设计与开发流程中，融入**基于规则的智能建议引擎**和**企业级的可视化配置工具**，将平台从一个被动的“工具”提升为一个主动的“智能助手”。

**本计划已全面融入健壮性、性能监控、可视化能力与智能化增强的优化点。**

---

## **横切关注点：智能建议引擎 (贯穿各阶段)**
*   **开发目标**:借鉴《模板驱动优化》文档，在后端创建一个`MetadataSuggestionService`，并在前端的可视化工具中调用它，为用户的设计过程提供上下文感知的智能建议。
*   **为什么要这样开发**: 极大提升开发效率和规范性。通过命名约定自动推断类型、校验规则，并主动提示最佳实践，可以有效避免错误，降低用户心智负担。
*   **核心功能点**:
    1.  **后端 `MetadataSuggestionService`**: 实现基于命名约定的规则集，用于推断字段类型、建议关联字段、检查最佳实践（如是否启用审计/软删除）。
    2.  **前端 `EntityDesigner` 集成**: 在用户输入属性名时，调用建议服务，并将结果以“高亮提示+一键采纳”的形式展示在UI上。
    3.  **前端 `ModuleWizard` 集成**: 增加“设计规约检查”功能，调用后端服务对整个模块的元数据进行合规性检查。

---

## **第一阶段：统一元数据模型设计与持久化 (基石)**
**总目标**：构建一个能完整描述全链路业务场景的“单一事实来源”（`ModuleMetadata`），并实现其在后端的可靠存储。
*此阶段已完成*

---

## **第二阶段：向导式元数据定义器 (交互入口 - “第一界面”)**
**总目标**：打造一个全新的、集成了高级可视化配置能力的向导式元数据定义界面，作为用户与引擎交互的核心入口。

### **2.1 创建 `ModuleWizard` 视图并集成 `EntityDesigner` (V9核心)**
*   **开发目标**: 创建一个全新的 `ModuleWizard.vue` 视图组件，它使用步骤条引导用户完成**模块信息、实体设计、菜单、权限、UI配置**等所有元数据的定义。
*   **为什么要这样开发**: 严格遵循用户指令中关于“第一界面”的要求。向导式流程可以分解复杂性，引导用户完成整个模块的元数据配置，而不是仅仅设计单个实体。
*   **核心功能点**:
    1.  `ModuleWizard.vue` 使用 `ElSteps` 组件构建向导流程。
    2.  **实体设计步骤**: 嵌入 `EntityDesigner` 和 `RelationshipDesigner`，完成对实体、属性、关系的完整定义。
    3.  **UI配置步骤**: 新增专门的UI配置界面，允许用户在此阶段就定义好列表页、表单页、详情页的**高级别UI策略**。例如：
        *   详情页布局选择：`Tabs` (用于主从表) 或 `Sections` (标准分节)。
        *   可选UI主题风格：提供至少三种预设主题（如 `Modern`, `Compact`, `Enterprise`）。
        *   列表页高级功能开关：启用/禁用高级查询、批量操作等。

### **2.2 (新增) 实现`DataBindingPanel`，提供完整的可视化数据绑定能力**
*   **开发目标**: 借鉴《可视化能力增强》文档，创建一个强大的`DataBindingPanel.vue`组件，让用户通过点击、选择和配置来完成复杂的数据绑定，彻底取代手写表达式。
*   **为什么要这样开发**: 这是提升平台易用性的关键。将数据源、字段选择、数据过滤与转换等操作完全可视化，是低代码平台“低代码”价值的核心体现。

### **2.3 (新增) 实现`ActionOrchestrator`，提供可视化动作编排能力**
*   **开发目标**:借鉴《可视化能力增强》文档，设计并实现一个可视化的动作编排系统。用户可以通过拖拽和组合预定义的“动作积木”（如调用API、打开弹窗、页面跳转、显示提示）来定义组件事件的响应逻辑。
*   **为什么要这样开发**: 彻底消除在前端写事件处理代码的需求，让业务逻辑的定义过程也实现“低代码化”。

### **2.4 (新增) 实现`RoleInheritanceDesigner`，提供可视化权限继承配置**
*   **开发目标**: 借鉴《可视化能力增强》文档，创建一个`RoleInheritanceDesigner.vue`组件，使用关系图或树状图的形式，让用户通过拖拽和连接来配置角色之间的继承关系。
*   **为什么要这样开发**: 解决权限系统配置中最复杂、最容易出错的环节。将抽象的继承关系图形化，极大降低了配置难度和错误率。

---

## **第三阶段：企业级UI生成与运行时容器 (核心改造)**
**总目标**：改造代码生成流程，使其能够根据元数据一键生成高质量、功能完备的企业级UI，并提供一个能动态渲染这些UI元数据的运行时容器。

### **3.1 增强代码生成器，产出“企业级UI骨架 + UI元数据”**
*   **开发目标**: 升级 `CodeGenerationOrchestratorService`，使其能够消费 `ModuleMetadata` 中的 `uiConfig`，并使用一套**预置的企业级UI模板**来生成高质量的前端页面。
*   **为什么要这样开发**: 实现“高质量起点生成”的核心承诺。引擎的价值不仅在于生成代码，更在于生成的代码质量。
*   **核心功能点**:
    1.  **创建企业级UI模板库**: 开发一套基于Vue3和Element Plus的高质量UI模板，包括：
        *   `List-Page-Template.vue`: 内置高级查询、分页表格、工具栏按钮。
        *   `Detail-Page-Tabs-Template.vue`: 用于主从关系，自动生成Tab页布局。
        *   `Form-Modal-Template.vue`: 标准化的增、改表单弹窗。
    2.  **生成产物分离**: 生成流程的产物分离为：
        *   一个轻量的`.vue`骨架文件，负责加载运行时容器。
        *   一个独立的`.meta.json`文件，包含了从`uiConfig`转换而来的、驱动UI渲染的精确元数据。

### **3.2 开发运行时页面渲染器 `MetadataDrivenPageRenderer`**
*   **开发目标**: 创建通用的 `PageRenderer.vue` 组件，它能接收一份UI元数据 (`.meta.json`)，并据此动态渲染出完整的、包含复杂交互逻辑的页面。
*   **为什么要这样开发**: 这是实现“可视化微调”和运行时驱动的基础。我们需要一个“播放器”来动态解释和呈现UI元数据。

### **3.3 (新增) 融入错误恢复与事务机制**
*   **开发目标**: 增强后端的 `CodeGenerationOrchestratorService`，确保全栈代码生成过程具备原子性。任一环节失败，都应**自动回滚**所有已生成的文件。
*   **为什么要这样开发**: 提升引擎的**稳定性和可靠性**，避免产生污染的中间状态。

### **3.4 (新增) 融入性能埋点**
*   **开发目标**: 在代码生成的关键节点和运行时渲染的核心逻辑中，加入性能监控埋点。
*   **为什么要这样开发**: 为引擎的**性能优化**提供数据支撑。

### **3.5 (新增) 后端实现`RealtimePermissionSyncService`与`TenantAwareCacheService`**
*   **开发目标**: 借鉴《可视化能力增强》文档，实现实时权限同步和多租户缓存隔离。
*   **为什么要这样开发**: 解决企业级应用中常见的权限变更延迟和多租户数据安全问题。

---

## **第四阶段：三栏式可视化UI定制器 (体验飞跃 - “第二界面”)**
**总目标**：实现一个专业级的、所见即所得的UI定制器，它直接编辑UI元数据，并通过运行时渲染器**实时、无编译**地展现变更。

### **4.1 创建 `UICustomizer` 视图，实现专业级三栏式布局**
*   **开发目标**: 创建 `UICustomizer.vue` 视图，它能加载一个由 `PageRenderer` 渲染的页面，并提供专业的三栏式布局进行可视化微调。
*   **为什么要这样开发**: 这将**最大化利用项目已有的运行时能力**，提供极致的“所见即所得”体验，完全符合用户指令中对“第二界面”的要求。
*   **核心功能点**:
    1.  **左栏：组件库**: 提供Element Plus基础组件和项目自定义业务组件，支持拖拽到中栏画布。
    2.  **中栏：实时渲染画布**: 直接嵌入 `PageRenderer` 实例，实时、可交互地显示UI。
    3.  **右栏：属性检查器**: 选中中栏的任一组件，右栏将显示其所有可配置的属性（Props）、样式（Style）和数据绑定（Data Binding），并支持实时修改。
    4.  **核心机制**: `UICustomizer` 的所有操作（拖拽、修改属性）都在**直接修改**Pinia Store中加载的当前页面的UI元数据。`PageRenderer` 则响应式地监听这些元数据的变化并实时重新渲染，从而实现所见即所得。
