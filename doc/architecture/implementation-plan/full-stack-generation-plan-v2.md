### **技术评审文档：SmartAbp 全栈代码生成引擎开发计划 (V2.0)**

**文档版本**: 2.0
**作者**: 首席架构师 (Serena AI)
**日期**: 2025-09-18
**评审状态**: **待批准**

#### **1. 核心目标 (修正)**

摒弃所有中间过程，**唯一的核心目标**是实现一个“**一键生成**”按钮，该按钮能够基于向导中配置的元数据，一次性生成一个功能完整、可立即访问、包含前后端所有必要元素的全栈业务模块。

#### **2. 架构决策 (重申)**

所有代码生成，无论是前端还是后端，都将严格遵循“**生成与定制分离**”的架构原则。后端使用 **`partial` 类** 和 `*.generated.cs` 文件模式；前端使用 **Composable/Hooks** 和 `*.generated.ts`/`*.generated.vue` 文件模式。

---

### **3. 前端界面改造计划 (遵照指示)**

*   **子节点 1.1: 菜单重命名**
    *   **要实现什么**: 将 `ModuleWizardView.vue` 对应的导航菜单文本从“模块向导”修改为“**代码生成**”。
    *   **为什么这么实现**: 精准反映此功能的核心价值——代码生成。

*   **子节点 1.2: 向导流程重构**
    *   **要实现什么**: 将向导流程重新设计为清晰的、面向最终结果的步骤，倒数第二步必须是“**预览与生成**”，包含“**一键生成**”按钮。最后一步是“**UI设计器**”。
    *   **为什么这么实现**: 优化用户体验，让用户的所有配置都服务于“一键生成”这个最终目标，并在生成后无缝衔接到UI定制环节。

---

### **4. “一键生成”功能实现计划 (分阶段)**

#### **阶段一：后端“原子能力”补全**

> 此阶段的目标是让后端生成器具备生成一个**独立、完整、可运行**的ABP模块所需的所有“原子能力”。

*   **子节点 2.1：后端架构重构 (进行中)**
    *   **要实现什么**: 完成“生成与定制分离”的 `partial` 类架构重构。
    *   **目前状态**: 已完成分层生成器的创建，需要为所有生成器添加 `partial` 和 `*.generated.cs` 的支持。

*   **子节点 2.2：EF Core 层增强 (进行中)**
    *   **要实现什么**: 完成 `DbContext` 的 `partial` 方法扩展，以便开发者可以安全地自定义数据库映射。
    *   **目前状态**: 已生成基础的 `DbContext`，但尚不支持 `partial` 扩展。

*   **子节点 2.3：权限系统生成 (高优先级)**
    *   **要实现什么**: 生成 `...Permissions.cs` 和 `...PermissionDefinitionProvider.cs`，并自动在应用服务上添加 `[Authorize]` 特性。
    *   **目前状态**: 功能空白。

*   **子节点 2.4：ABP 模块类与数据库表生成 (高优先级)**
    *   **要实现什么**:
        1.  生成所有必需的 `...Module.cs` 模块定义类。
        2.  确保当 `dotnet run ...DbMigrator.csproj` 启动时，能够根据生成的实体和 `DbContext` **自动创建数据库表**。
    *   **目前状态**: 功能空白。

#### **阶段二：前端“原子能力”补全**

> 与后端并行，此阶段的目标是让前端生成器具备生成一个**独立、完整、可运行**的Vue模块所需的所有“原子能力”。

*   **子节点 3.1：前端架构设计与实现**
    *   **要实现什么**: 建立前端代码生成器的基础，同样消费 `ModuleMetadataDto`，并遵循“生成与定制分离”的原则。
    *   **目前状态**: 功能空白。

*   **子节点 3.2：API 客户端与状态管理 (高优先级)**
    *   **要实现什么**:
        1.  自动生成类型化的前端API服务 (`*.api.generated.ts`)。
        2.  自动生成类型化的 Pinia 状态管理文件 (`*.store.generated.ts`)。
    *   **目前状态**: 功能空白。

*   **子节点 3.3：菜单与路由生成 (高优先级)**
    *   **要实现什么**:
        1.  动态生成符合 `vue-router` 规范的路由配置文件 (`*.routes.generated.ts`)。
        2.  **自动**将生成的菜单项和路由注册到主应用中，确保生成后刷新浏览器即可看到新模块的菜单。
    *   **目前状态**: 功能空白。

#### **阶段三：全栈集成与“UI设计器”**

> 此阶段的目标是将前后端所有已完成的“原子能力”整合到“一键生成”按钮下，并交付最终的UI设计与迭代能力。

*   **子节点 4.1：“一键生成”功能集成 (最终目标)**
    *   **要实现什么**: 在“预览与生成”步骤中，实现“一键生成”按钮的后端逻辑。点击后，该按钮将调用 `CodeGenerationAppService`，后者会依次调用所有已完成的前后端生成器，一次性输出全栈代码。
    *   **目前状态**: `CodeGenerationAppService` 只能生成不完整的后端代码。

*   **子节点 4.2：默认UI界面生成**
    *   **要实现什么**: 生成一个企业级的标准管理页面 (`*.vue`)，默认包含：**查询/高级查询区域、数据表格、分页、增/删/改按钮、导入/导出功能**。
    *   **目前状态**: 功能空白。

*   **子节点 4.3：高级UI模式支持与迭代**
    *   **要实现什么**:
        1.  为“UI设计器”步骤打下基础，允许加载并预览默认生成的UI界面。
        2.  为未来的UI模式（如 **TABS界面、一对多/多对多、MDI界面**）预留扩展点。
        3.  确保在UI设计器中修改配置后，可以**再次触发增量生成**，更新全栈代码，并返回到UI预览界面，形成一个完整的“**设计-生成-预览-再设计**”的闭环。
    *   **目前状态**: 功能空白。

---

### **5. 计划执行**

我将立即停止所有其他探索性的工作，将100%的精力投入到执行这个新的、以交付为导向的计划中。
