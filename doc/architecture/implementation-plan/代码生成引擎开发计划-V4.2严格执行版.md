### 代码生成引擎 V4.2 — 严格执行计划（零遗漏版）

状态: 执行计划（严格）
来源: 代码生成引擎开发计划-V4.2最终功能定制版.md
日期: 2025-09-18

---

## 0. 强制执行原则
- 不允许遗漏“最终功能定制版”中的任何功能要点
- 不允许以“后续补齐”为由跳过校验、规则或接口
- 全流程以“契约先行、数据驱动、后端处理复杂性”为准绳
- 每项功能均附带明确的验收标准、测试用例与回归清单

---

## 1. 步骤一：新建模块（Module Wizard）— 零遗漏分解

表格来自“V4.2 终版”，此处转化为执行清单：

### 1.1 前端 UI 要求（ModuleWizardView.vue）
- 输入框（系统名称）systemName
  - 校验：必填、PascalCase（正则 ^[A-Z][A-Za-z0-9]*$）
  - UX：失焦即校验，错误提示；示例占位 SmartConstruction
- 输入框（模块名称）name
  - 校验：必填、PascalCase；与 systemName 拼装预览命名空间 `SmartAbp.{systemName}.{name}.*`
- 输入框（显示名称）displayName
  - 校验：必填；在右侧预览“菜单标题/页面标题”的效果
- ElTreeSelect（父级菜单）frontend.parentId
  - 数据：调用 GET /api/code-generator/menus 返回树
  - 默认：允许空（视为根）
  - 禁止手填 ID，仅允许选择
- 单选框组（架构模式）architecturePattern
  - 选项：Crud（默认）、DDD（置灰不可选，后续阶段开启）
  - 说明：在 UI 内清楚标注为何 DDD 暂不可选
- 输入框（前端路由前缀）frontend.routePrefix
  - 校验：必填；以 / 开头；kebab-case（^\/[a-z0-9]+(?:-[a-z0-9]+)*$）
  - 预览：展示将生成 path 与 API Base 前缀
- 折叠面板（高级）
  - 默认折叠；不影响首屏“3分钟体验”
- L 下拉框（数据库连接）databaseInfo.connectionStringName
  - 数据：调用 GET /api/code-generator/connection-strings
  - 校验：必选；默认 Default
  - 说明：选择影响后端 DbContext 连接设置与 DbMigrator 注册
- L 输入框（数据库 Schema）databaseInfo.schema
  - 校验：必填；小写 + 下划线（^[a-z]+(_[a-z]+)*$），示例 sm_project
- L 开关（生成移动端页面）generateMobilePages
  - 默认：否；当前版本生成器忽略该选项但需入库（元数据保留）

交互与状态
- onMounted 并发加载菜单树与连接串（loading skeleton）
- 提交前 TypeScript 层强校验（和 C# DTO 对齐）
- 提交禁用按钮，展示进度与错误提示

### 1.2 后端接口与契约
- DTO：`ModuleMetadataDto`（现有 V9）字段需完整映射上述 UI
- API：
  - GET `/api/code-generator/menus` → `List<MenuItemDto>`（树）
  - GET `/api/code-generator/connection-strings` → `List<string>`
  - POST `/api/code-generator/generate-module` → `GeneratedModuleDto`
- 规则：
  - `GenerateModuleAsync` 严格使用输入元数据（禁止测试数据）
  - 在生成之前调用 `DefaultUIConfigGenerator.ApplyDefaults(metadata)`
  - 生成顺序：后端 → 解决方案集成 → 迁移 add+update → 前端生成 → 前端 AST 集成

### 1.3 生成与集成（与蓝图一致）
- 后端代码：Roslyn 生成 Domain/EF/Application/Contracts 等
- 解决方案集成：添加项目到 `.sln`、必要引用
- 数据库迁移：执行 `dotnet ef migrations add` 成功后，执行 `dotnet ef database update`
- 前端代码生成：消费 UIConfig 和模板
- 前端自动集成：路由与菜单 AST（TS Compiler API），保证幂等与格式

### 1.4 校验与默认值（明确到规则级）
- PascalCase 校验失败：阻断提交，显示规则说明
- kebab-case + 以 `/` 开头校验失败：阻断提交
- Schema 小写下划线校验失败：阻断提交
- 架构模式仅 Crud：UI 禁用 DDD；服务端允许仅 Crud 分支
- 连接串未选择：阻断提交（默认 Default 自动回填也可）

### 1.5 验收标准（Acceptance Criteria）
- 成功路径：
  - 正确加载菜单树与连接串
  - 提交后返回 `GeneratedFiles`，输出包含后端与前端文件
  - 迁移与数据库更新成功日志存在
  - 路由/菜单已自动插入且页面可访问
- 失败路径：
  - 任一校验错误时禁止提交；错误消息明确
  - 后端异常返回被前端提示并可重试
- 幂等性：
  - 相同模块名重复提交不产生重复菜单/路由节点

### 1.6 测试与覆盖
- 前端单测（Vitest）：
  - 校验函数（PascalCase、kebab-case、schema）
  - API 调用成功/失败分支
  - 表单禁用与加载状态
- 前端 E2E（Cypress）：
  - 完整“新建模块”流程（含选择父菜单、连接串、提交、结果校验）
- 后端单测（xUnit）：
  - `GetConnectionStringNamesAsync` 返回非空且包含 Default
  - `GetMenuTreeAsync` 返回树结构（模拟仓储）
  - `GenerateModuleAsync` 使用入参且生成顺序正确（可通过日志与文件清单断言）

---

## 2. 后续步骤概要（与“最终功能定制版”一致）
- 领域建模契约补全与生成器升级（关系、删除行为、外键可空性、多对多 Join 实体）
- 权限设置（强类型常量、Authorize 特性、预览）
- 智能默认 UI 生成（规则库 → UIConfig）
- UI 设计器（三栏式，实时渲染引擎 + 模拟数据生成器）
- 生成与自动集成（已在 1.3 概述，后续步骤深化）

---

## 3. 质量门槛与检查
- 后端：`dotnet build` 通过；关键服务单测覆盖≥80%
- 前端：`npm run type-check`、`npm run lint --fix`、`npm run test:coverage`（≥80%）、`npm run build`
- 模板使用率：生成产物必须来源于 templates/
- 安全：无 `any` 滥用；无生产 `console.*`；不使用动态执行于生产

---

## 4. 里程碑
- 里程碑 M1：完成“新建模块”端到端（本章节全部验收达标）
- 里程碑 M2：领域建模契约与生成器升级
- 里程碑 M3：智能 UI 与设计器联动

---

## 5. 交付与回执
- 生成回执包含：文件清单、迁移与 DB 更新日志、AST 变更摘要、权限常量清单
- 文档更新：Serena 索引、实现计划、若涉及架构变更则新增 ADR

---

## 2. 步骤二：领域实体建模（Domain Modeling）— 零遗漏分解

参考“最终功能定制版”的契约升级要求，将其落地为执行项：

### 2.1 前端 UI 要求（实体与关系）
- 实体编辑器：新增/编辑/删除实体（名称、显示名、描述、是否聚合根、审计、软删、多租户、基类、接口、表名、Schema、版本、标签）
  - 校验：实体名 PascalCase、唯一；显示名必填；表名默认复数化、可改；Schema 默认继承第一步的 schema
- 属性编辑器：新增/编辑/删除属性
  - 字段：名称、显示名、类型（string/int/decimal/datetime/bool/enum/外键等）、是否必填、唯一、索引、默认值、描述、帮助、长度/精度/范围、审计/软删/租户字段标识、可见性（列表/详情/表单）、排序/过滤/搜索、顺序
  - 校验：名称 camelCase；类型必选；MaxLength>0 时为有效；精度/范围合法；可见性三态至少一处使用
- 关系编辑器：根据“最终功能定制版”新增字段
  - 字段：Id、Name、DisplayName、SourceEntityId、TargetEntityId、TargetEntity、Type（OneToMany/ManyToOne/ManyToMany 等）、SourceProperty、TargetProperty、导航属性、CascadeDelete、IsRequired、ForeignKeyProperty、JoinTableName、OnDeleteAction、IsForeignKeyRequired、DeleteBehavior（枚举：Cascade/Restrict/NoAction/SetNull）、JoinEntity（多对多中间实体定义）
  - 校验：
    - 必填：Source/Target 指针一致性
    - 多对一：外键属性必须存在；IsForeignKeyRequired → 外键是否可空
    - 多对多：JoinEntity 必须完整；JoinTableName 合法

### 2.2 DTO 与契约同步
- 后端 C#：`Dtos.cs`（V9）中的 `EntityRelationshipDto` 扩展字段（IsForeignKeyRequired、DeleteBehavior、JoinEntity）必须落地
- 前端 TS：`packages/lowcode-api/src/types.ts` 完成 1:1 同步，新增相同字段与枚举，类型守卫

### 2.3 生成器升级要求
- DomainGenerator：
  - 导航属性：按关系生成集合/单体导航
  - 外键属性：依 `IsForeignKeyRequired` 生成 Guid 或 Guid?
- EntityFrameworkCoreGenerator：
  - Fluent API：按关系生成 `.HasOne/.WithMany/.HasForeignKey/.IsRequired(...).OnDelete(DeleteBehavior.X)`
  - 多对多：生成 Join 实体（必要时），并使用 `HasMany().WithMany().UsingEntity(...)` 正确指定左右键

### 2.4 验收标准
- 实体/属性/关系的数据模型在前端与后端完全一致（契约校验通过）
- 生成的实体包含正确的导航与外键属性；EF 配置包含正确的 Fluent API（含 IsRequired 与 OnDelete）
- 迁移与 `database update` 成功；数据库结构与契约一致

### 2.5 测试与覆盖
- 前端：实体/属性/关系编辑器的校验单测；关系建模 E2E（创建一对多、多对多并生成）
- 后端：
  - DTO 映射与验证单测（必填/非法值）
  - 生成器单测：输入关系元数据，输出代码包含预期导航和 Fluent API 片段（字符串断言或 Roslyn 解析）
  - 迁移与数据库更新集成测试（沙箱数据库）

---

## 3. 步骤三：权限设置（Permissions）— 零遗漏分解

与“最终功能定制版”的强类型权限方案对齐：

### 3.1 前端 UI 要求
- 标准 CRUD 权限区（只读预览）：根据实体列表自动显示（Default/Create/Update/Delete）
- 自定义操作（Extended Features）
  - 新增弹窗：
    - Action（Select，系统预定义：Approve/Reject/Publish/Assign/...）
    - Entity（Select，本模块实体列表）
    - DisplayName（输入，面向 UI 的显示名）
    - Permission Preview（只读，实时显示如 `ProjectManagement.Project.Approve`）
  - 校验：Action/Entity 必选；DisplayName 非空；Permission Preview 系统生成、不可编辑
  - 列表支持：新增/编辑/删除自定义操作，实时更新预览

### 3.2 元数据与生成
- 元数据：PermissionDto（或等价）
  - 字段：`ActionKey`（如 "Approve"）、`EntityName`（如 "Project"）、`DisplayName`
  - 严禁存储最终权限字符串，仅存储语义化键
- ApplicationContractsGenerator：
  - 强类型权限常量类（`{Module}Permissions`）：标准与自定义权限常量均生成
  - PermissionDefinitionProvider：根据元数据生成分组、默认与子权限定义，使用 `LocalizableString`
- ApplicationGenerator：
  - AppService 方法上的 `[Authorize({Module}Permissions.Entity.Action)]` 按强类型常量引用，禁止魔法字符串

### 3.3 验收标准
- UI 权限预览正确；新增/编辑/删除自定义操作同步到元数据
- 生成的常量类与 Provider 编译通过；权限命名与预览一致
- AppService 使用强类型常量；权限校验生效（可通过冒烟用例模拟）

### 3.4 测试与覆盖
- 前端：
  - Action 下拉与 Entity 下拉交互校验；Permission Preview 实时拼接预期
  - 自定义操作 CRUD 的单测与 E2E
- 后端：
  - 常量类生成单测：常量名与值断言
  - Provider 生成单测：`AddGroup` 与 `AddChild` 片段存在
  - AppService 授权测试：未授权返回 403，授权后 200

---

## 4. 联动与提交流程（三步串联）
- 前端向导分为三步：新建模块 → 领域建模 → 权限设置
- 仅当三步均通过校验时，才允许提交 `ModuleMetadataDto` 进行代码生成
- 提交前执行整体契约校验（前端 TS + 后端 C#）
- 回执包含：生成文件清单、迁移/DB 日志、AST 变更、权限常量清单

---

## 5. 步骤四：智能生成默认 UI 与全栈代码 — 零遗漏分解

本步骤严格落实“最终功能定制版”第四步（智能默认 UI）与第六步（生成与集成）的要求，将“企业级品味”规则库具体化为工程执行项。

### 5.1 后端智能 UI 规则引擎（DefaultUIConfigGenerator 扩展）
- 触发时机：在 `CodeGenerationAppService.GenerateModuleAsync` 入口，接收元数据后、任何代码生成之前执行
- 输入：完整的 `ModuleMetadataDto`（含实体、属性、关系、权限）
- 产出：为每个实体填充 `EntityUIConfigDto`（ListConfig、FormConfig、DetailConfig 等）
- 规则库（零遗漏对齐“最终功能定制版”）：
  - 高级查询区（QueryFields）
    - 自动包含：string/DateTime/int/decimal/bool/enum/多对一外键
    - 智能排除：Id、长文本（MaxLength>500）、审计字段、文件字段
    - 组件匹配：string→el-input、DateTime→el-date-picker(daterange)、enum/bool→el-select
    - 逻辑匹配：string→contains、数值/时间→range、enum/bool/fk→equals
  - 功能操作区（ActionBar）
    - 权限联动：仅当启用标准权限（Create/Update/Delete）或自定义权限时，生成对应按钮
    - 默认布局：表格上方（新增/批量删除/导出），行内（编辑/删除）
  - 数据表格区（TableColumns）
    - 智能列选：默认显示所有非 Id、非长文本、非导航属性字段
    - 默认包含：CreationTime、LastModificationTime（可排序）
    - 外键显示：外键字段显示关联实体的 Name/DisplayName
  - 模态表单（FormFields）
    - 自动包含：所有可编辑字段；排除 Id、审计字段、集合导航
    - 组件映射：按类型映射 Element Plus 组件
    - 校验规则：继承 IsRequired/MaxLength/范围/正则等
- 非功能性要求：
  - 幂等性：重复运行生成相同配置
  - 可扩展性：规则点通过策略/权重实现，便于后续细化
  - 观测性：输出规则命中统计（多少字段进入查询、表格、表单）

### 5.2 前端生成（模板驱动 + UIConfig 消费）
- 生成器：`FrontendGenerator` 必须消费 `EntityUIConfigDto`
- 模板：
  - 组件：`templates/frontend/components/CrudManagement.template.vue`
  - Store：`templates/frontend/stores/EntityStore.template.ts`
- 模板参数映射（示例）：
  - EntityName/entityName/ModuleName/entityDisplayName/kebab-case-name
  - QueryFields/TableColumns/FormFields/ActionBar 映射至对应模板块
- 生成文件（每实体）：
  - 视图组件：`src/SmartAbp.Vue/src/views/{Module}/{Entity}Management.vue`
  - API 文件：`src/SmartAbp.Vue/src/api/{module}/{entity}.ts`
  - Store：`src/SmartAbp.Vue/src/stores/modules/{module}/{entity}.ts`
- 要求：类型严格、组合式 API、Element Plus 规范（不留 any）

### 5.3 前端自动集成（AST）
- 服务：`FrontendIntegrationService`
- 路由：
  - 解析并修改 `src/SmartAbp.Vue/src/router/index.ts`，在 `{frontend.routePrefix}` 下插入模块路由，懒加载组件
  - 命名/路径幂等，避免重复节点；保持原格式与注释
- 菜单：
  - 解析并修改菜单结构（当前项目将菜单与路由合并管理，按本仓库实际结构在路由 meta 中增加菜单元信息；如存在独立菜单文件，采用相同 AST 策略注入）
- 回执：输出插入位置、节点摘要、结果片段用于审查

### 5.4 后端生成与集成（统一工作流）
- 代码生成：按架构模式（目前 Crud）调用各层生成器（Domain/EF/Application/Contracts/Tests 可选）
- 解决方案集成：将新项目加入 `.sln`，按需添加项目引用
- 数据库迁移：
  - `dotnet ef migrations add {GeneratedName}`
  - 成功后执行 `dotnet ef database update`
  - 日志落盘，失败不中断后续（按策略），但在回执中标记并建议修复

### 5.5 验收标准（Acceptance Criteria）
- 产物可运行：构建无误（前后端）、数据库已更新、新页面可访问
- UI 完整：包含“查询区、操作区、表格、表单”基础功能，并符合权限联动
- 集成到路由：新路由可见且不重复；菜单/标题显示正确
- 回执完整：包含文件清单、迁移与更新日志、AST 变更摘要

### 5.6 测试与覆盖
- 后端：
  - DefaultUIConfigGenerator 规则单测（典型实体/类型/权限组合）
  - FrontendIntegrationService AST 操作单测（插入/去重/幂等/格式保持）
  - 端到端集成测试：给定元数据 → 断言文件集、迁移日志、路由变更
- 前端：
  - 模板渲染快照测试（基于 UIConfig 渲染表单/表格/按钮）
  - E2E：生成后访问新路由，验证交互基本可用

### 5.7 性能与安全门槛
- 性能：
  - 默认 UI 计算 < 200ms/实体（基线）
  - AST 操作单文件 < 100ms（基线）
  - 批量并发 ≤ 5，可配置
- 缓存：规则与模板结果可缓存；命中率目标 > 50%
- 安全：
  - 生产禁用动态执行；日志通过适配器
  - 不输出 any；严格 TS；不残留 console

### 5.8 回滚与可审查性
- 生成的 `.generated.*` 文件带时间戳与“DO NOT EDIT”标识
- 变更回执可用于审查与回滚（含 AST 节点摘要）

---

## 6. 步骤五：UI 定制（Live UI Customizer）— 零遗漏分解

目标：提供企业级、所见即所得的页面定制能力，严格遵循“生成与定制分离”，只通过 Schema/UIConfig 实现定制，不允许直接修改生成文件。

### 6.1 前端实现（三栏式设计器）
- 组件：`LiveUICustomizer.vue`（或 `packages/lowcode-designer/src/components/UICustomizer.vue` 复用）
- 布局：左（组件库/数据源）— 中（实时画布）— 右（属性检查器）
- 画布：渲染“默认 UI”（来自 `EntityUIConfigDto`）
- 交互：
  - 拖拽：从左侧将字段拖入“查询区/表格/表单”；可拖动调整顺序
  - 选中高亮：点击某列/字段，右侧属性检查器显示可配置项
  - 属性编辑：
    - 查询区字段：label、placeholder、operator（contains/equals/range）、组件类型（input/select/date）
    - 表格列：label、width、sortable、formatter（date/money/enum/fk-name）
    - 操作区：启用/禁用（create/update/delete/export）、权限绑定
    - 表单字段：组件类型、校验规则（required、maxLength、pattern、range）
  - 撤销/重做：基础的历史栈
  - 预览：实时更新画布；切换移动端/桌面预览（移动端为预留）
- 校验：
  - 字段重复、无效组合（如表单不可编辑字段被设为可编辑）
  - 规则与后端契约一致性（本地类型守卫 + 保存前后端验证）

### 6.2 后端接口（UI 配置存取）
- 服务：`UIConfigService`
- API：
  - GET `/api/code-generator/ui-config?module={m}&entity={e}` → `EntityUIConfigDto`
  - POST `/api/code-generator/ui-config` → 保存 `EntityUIConfigDto`
- 规则：
  - 仅允许写入 UIConfig，不允许修改实体/属性/权限核心契约
  - 版本与时间戳；可选择持久化到文件或数据表

### 6.3 运行时注入与应用
- 页面加载：优先读取已保存的 UIConfig；否则使用默认 UIConfig
- 生成与定制分离：生成代码不被修改；页面运行时通过 UI 渲染器消费 UIConfig（动态生成表单/表格/按钮）
- 幂等：反复进入与保存不破坏 UI 配置结构

### 6.4 验收标准
- 设计器可完成：新增/删除/排序字段；切换组件与格式化；切换权限联动；即时预览
- 保存后刷新页面：UIConfig 被应用且表现一致
- 无直接编辑 `.generated.*` 文件；定制仅通过 UIConfig 生效

### 6.5 测试与覆盖
- 前端：
  - 拖拽/排序/属性编辑单测；画布快照测试
  - E2E：定制后保存并刷新，验证 UI 渲染一致
- 后端：
  - UIConfig 读写单测；契约验证；版本与并发保存（乐观锁可选）

### 6.6 性能与安全
- 性能：
  - 画布渲染 ≤ 100ms；拖拽交互 60fps
  - 大配置（>100 字段）可分页/虚拟滚动
- 安全：
  - 禁止动态执行；仅渲染白名单组件
  - 服务端验证 UIConfig 合法性（字段、类型、权限名）

### 6.7 回滚与版本管理
- 每次保存生成一个版本；支持选取历史版本恢复
- 版本元数据：创建时间、操作者、摘要（变更点统计）

---

## 7. 统筹开发计划（实施排期与依赖）— 覆盖步骤一至步骤五所有功能要点

本章提供端到端的实施计划，确保“零遗漏”。所有功能点均来自第 1~6 章的细化清单，任何未达成项禁止进入下个里程碑。

### 7.1 里程碑与排期（可并行处标注“∥”）
- M0 准备（0.5d）
  - 同步模板索引/ADR/规则 → 工程依赖与脚手架检查
  - 打通后端基础 API（连接串、菜单树、生成）∥ 前端项目运行与测试基线

- M1 新建模块（2~3d）
  - 前端：ModuleWizard 界面 + 校验 + API 对接（1.1 全量）
  - 后端：ICodeGenerationAppService 3 个端点验收；GenerateModuleAsync 使用真实入参
  - 验收：1.5/1.6 全部通过

- M2 领域实体建模（4~5d）
  - 契约：C# DTO 扩展 + TS 类型 1:1 同步（2.2）
  - 生成器：Domain/EF 升级（导航/外键/Fluent API/多对多）（2.3）
  - 验收：2.4/2.5 全部通过

- M3 权限设置（2~3d）
  - 前端：标准 + 自定义权限 UI（3.1）
  - 后端：Permissions 常量类与 Provider 生成；AppService 授权（3.2）
  - 验收：3.3/3.4 全部通过

- M4 智能默认 UI + 全栈生成（4~6d）
  - 规则引擎：DefaultUIConfigGenerator 完整规则（5.1）
  - 前端生成：模板映射（组件/Store/API）消费 UIConfig（5.2）
  - AST 集成：路由/菜单自动注册（5.3）
  - 迁移编排：add + update（5.4）
  - 验收：5.5/5.6/5.7/5.8 全部通过

- M5 UI 定制（4~6d）
  - 设计器：三栏式拖拽/属性检查器/预览（6.1）
  - UIConfigService：读写/版本化/契约校验（6.2）
  - 运行时应用：生成与定制分离（6.3）
  - 验收：6.4/6.5/6.6/6.7 全部通过

- M6 稳定化（2~3d）
  - 回归与覆盖率补齐（≥80%）
  - 文档/Serena 索引/模板索引与 ADR 更新

### 7.2 工作分解结构（WBS → 功能点 100% 映射）
- 步骤一（1.1~1.6）：表单 9 项字段与交互/正则；3 个 API；顺序编排与幂等；验收与单测/E2E
- 步骤二（2.1~2.5）：实体/属性/关系编辑器；DTO/TS 同步；Domain/EF 生成器升级；迁移验证；测试
- 步骤三（3.1~3.4）：权限 UI（标准+自定义）；常量类/Provider；AppService Authorize；测试
- 步骤四（5.1~5.8）：UI 规则引擎；模板生成；AST 集成；迁移；性能与安全；回执与回滚；测试
- 步骤五（6.1~6.7）：LiveUICustomizer；UIConfig API；运行时应用；版本管理；性能与安全；测试

覆盖性校验矩阵（完成即勾选）
- [ ] 1.1~1.6 100% 实现
- [ ] 2.1~2.5 100% 实现
- [ ] 3.1~3.4 100% 实现
- [ ] 5.1~5.8 100% 实现
- [ ] 6.1~6.7 100% 实现

### 7.3 依赖与并行策略
- 并行优先：
  - M1 期间可并行实现前端校验与后端菜单/连接串 API
  - M2 契约扩展与生成器升级可拆分并行（DTO/TS vs Domain/EF）
- 强依赖：
  - M4 依赖 M2/M3 的实体与权限数据
  - M5 依赖 UIConfig 的默认生成（M4）

### 7.4 质量门槛与里程碑门禁
- 每里程碑必须通过：
  - 后端：`dotnet build` + 关键模块单测（≥80%）
  - 前端：`npm run type-check`、`npm run lint --fix`、`npm run test:coverage`（≥80%）、`npm run build`
  - E2E：关键用户路径（新建模块 → 生成 → 访问页面；设计器定制 → 保存 → 刷新生效）
  - 回执：文件清单/迁移日志/AST 变更/权限常量清单完整

### 7.5 风险与缓解
- AST 兼容/格式化：使用精确节点与 Printer；快照测试
- 迁移失败/脏数据：沙箱库演练；失败不中断但在回执标记；提供重试脚本
- 契约漂移：前后端类型守卫 + 服务端验证；CI 契约漂移检测
- 性能：并发 ≤5，超时与埋点；缓存命中率 >50%

### 7.6 文档与交付
- 每里程碑更新：严格执行版计划、Serena 索引、模板索引、必要 ADR
- 交付包：
  - 变更回执（含 AST 变更摘要/迁移日志）
  - 覆盖率与构建产物
  - 快速验证脚本与说明