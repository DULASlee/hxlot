# 低代码引擎 V10+ 架构路线图

## 核心目标：企业级动态安全与智能优化

在 V9 版本构建了强大的元数据驱动和可视化编排能力的基础上，V10 及后续版本将聚焦于以下两个核心方向，将平台从一个“高效的应用开发平台”提升为“智能的企业级解决方案构建平台”。

1.  **动态安全体系**: 实现精细化、上下文感知的动态权限与数据权限控制。
2.  **智能优化系统**: 引入自动化的性能分析与优化能力。

---

## 路线图详情

### **1. V10: 动态权限与数据权限 (核心)**

此版本将完全实现《9、四次优化（动态权限优化）.md》文档中定义的所有功能。

#### **1.1 条件权限引擎 (`ConditionalPermissionEngine`)**
*   **目标**: 实现基于表达式的动态权限规则，解决“在什么条件下，谁能执行什么操作”的问题。
*   **核心功能**:
    *   支持 `resource.createdBy === user.id` 等常见规则的预设。
    *   提供可视化的条件构建器 `ConditionalPermissionBuilder.vue`，支持业务人员通过UI配置复杂逻辑。
    *   后端 `EnhancedPermissionChecker` 将集成条件权限的评估逻辑。

#### **1.2 数据权限引擎 (`DataPermissionManager`)**
*   **目标**: 通过查询拦截，实现动态、行级别的数据过滤，解决“用户能看到哪些数据”的问题。
*   **核心功能**:
    *   通过 `[DataPermission]` 特性注解在应用服务层自动应用数据权限。
    *   支持基于“组织机构”（本人、本部门、本部门及下属）的预设规则。
    *   支持基于“属性过滤”和“自定义表达式”的灵活规则配置。
    *   提供 `DataPermissionConfigurator.vue` 界面用于集中管理所有数据权限规则。

#### **1.3 完善多租户隔离**
*   **目标**: 确保多租户在所有基础设施层面（文件、消息、定时任务）的完全隔离。
*   **核心功能**:
    *   实现 `TenantAwareBlobProvider`，自动为文件路径添加租户标识。
    *   实现 `TenantAwareMessageQueue`，通过为队列和路由键添加租户前缀来隔离消息。
    *   实现 `TenantAwareRecurringJob`，确保定时任务在正确的租户上下文中执行。

### **2. V11: 智能性能优化**

此版本将聚焦于平台的性能与稳定性，引入自动化分析和优化机制。

#### **2.1 查询优化器 (`QueryOptimizer`)**
*   **目标**: 自动分析查询并提供优化建议，解决潜在的性能瓶颈。
*   **核心功能**:
    *   **智能 `Include`**: 自动识别并使用分离查询（Split Query）来避免笛卡尔积问题。
    *   **索引建议**: 分析查询的 `WHERE`, `JOIN`, `ORDER BY` 子句，自动建议需要创建的数据库索引。
    *   **分页优化**: 对大偏移量的分页查询自动切换到更高效的键集分页（Keyset Pagination）。

#### **2.2 性能分析与监控 (`QueryPerformanceAnalyzer`)**
*   **目标**: 提供内置的性能监控和报告功能。
*   **核心功能**:
    *   自动测量关键查询的执行时间、内存消耗。
    *   生成性能报告，高亮显示慢查询和高内存消耗的查询。
    *   提供可视化的性能仪表盘。

---

## V9.2 中的先行试点

为了在当前版本中提前验证上述设计的可行性并交付部分价值，将在 V9.2 开发计划中融入以下MVP（最小化可行产品）功能：

*   **简版条件权限**:
    *   在 `ModuleMetadata` 的权限配置部分增加一个 `condition` 字符串字段。
    *   允许用户手写简单的JS表达式（如 `resource.CreatedBy === user.Id`）。
    *   后端代码生成器将此表达式硬编码到应用服务的权限检查方法中。
    *   **暂不开发**可视化的条件构建器UI。

*   **简版数据权限**:
    *   在 `ModuleMetadata` 的实体配置中增加一个 `dataPermissionScope` 枚举字段。
    *   提供预设选项: `None`, `CurrentUser`, `CurrentOrganization`, `CurrentOrganizationAndChildren`。
    *   后端代码生成器根据所选范围，在仓储的 `GetListAsync` 方法中硬编码加入相应的 `WHERE` 过滤条件。
    *   **暂不开发**灵活的数据权限规则配置UI。
