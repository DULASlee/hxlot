# P0 模块向导（Module Wizard）开发计划

## 1. 背景与目标
- 目标：提供向导式（Guide-driven）一键生成完整CRUD模块的能力，让新手用户在10分钟内无需查阅文档，即可在菜单中看到并使用“用户管理”模块（含列表、表单、权限、路由、菜单集成）。
- 范围：前端向导视图 + ModuleSchema/TemplatePack 类型 + 基础CRUD模板包 + CLI聚合写入 + 菜单/路由自动集成。
- 非目标：P1拖拽/实时预览、外部数据源连接（默认使用本项目OpenAPI/ABP契约）。

## 2. 学习要点（Serena替代：基于现有代码审阅与规则）
- 微内核：`src/SmartAbp.Vue/src/lowcode/kernel/*`（缓存/日志/监控/插件/事件）已具备企业级基线。
- 生成器：`plugins/vue3`、`plugins/router-generator`、`plugins/store-generator` 可用于生成页面/路由/Store；`plugins/sfc-compiler` 为P1预览能力铺垫。
- CLI：`src/SmartAbp.Vue/src/tools/cli.ts` 基于 `modules/<Feature>/abp.module.json` 聚合生成 routes/stores/lifecycles/policies 到 `src/appshell/*.generated.ts`（或项目定义位置）。
- 路由/菜单：`src/router/index.ts` 与 `src/config/menus.ts`；现有“代码生成”分组将新增“模块向导”。
- 质量门禁：`package.json` 已含 lint/type/test/build，CI含Danger与OpenAPI漂移检测。

## 3. 交付物（P0）
1) 类型与契约
- 在 `lowcode/kernel/types.ts` 补充：`ModuleSchema`、`TemplatePack`、`WizardStep`、`WizardState`、关键子类型（CRUDConfig、PermissionConfig、LayoutConfig 等），保持对现有类型的向后兼容。

2) 基础模板包（crud-basic）
- 新增 `lowcode/templates/crud-basic-template.ts`：
  - 页面：ListPage、FormPage（含搜索、分页、操作列、校验示例）。
  - Store：增删改查 + 分页状态 + Loading/Error 模式。
  - Service：基于统一API约定（与OpenAPI生成客户端一致）。
  - Routes：标准嵌套路由与 meta 配置（title/requiresAuth/requiredRoles）。
  - Permissions：`<Module>.Create/Read/Update/Delete` 映射至路由/按钮 v-permission 与 meta。

3) 向导视图（5步）
- 新增 `views/codegen/ModuleWizardView.vue`：
  - Step1 模板选择（默认“crud-basic”）
  - Step2 基本信息与数据源（moduleName/displayName/entityName；数据源默认本项目Swagger）
  - Step3 页面与字段配置（字段增删改、搜索字段、列表列配置）
  - Step4 权限配置（默认 admin 角色，操作映射可选）
  - Step5 预览与生成（展示即将生成的文件清单；一键生成）

4) 集成闭环
- 写入 `modules/<Feature>/abp.module.json`；
- 触发 CLI 生成：routes/stores/lifecycles/policies 至 `src/appshell/*.generated.ts`；
- 菜单/路由集成：优先生成 `menu.generated.ts` 与 `routes.generated.ts` 再由入口进行聚合（避免直接改写手写文件）。

5) 示例与文档
- 一键示例：`UserManagement`（演示默认字段 name/email/phone/department/isActive/creationTime）。
- 文档：`docs/模块向导使用.md`；`templates/README.md` 增补 TemplatePack 说明与参数映射表。

## 4. 实施步骤
- S1：定义 `ModuleSchema/TemplatePack/Wizard*` 类型 + 轻量校验（Zod或自校验）。
- S2：实现 `crud-basic` TemplatePack（List/Form/Service/Store/Routes/Permissions）。
- S3：创建 `ModuleWizardView.vue` 骨架（ElementPlus Steps + 子面板），默认参数可直达“生成”。
- S4：串联生成：写 manifest → 触发 codegen → 写 appshell *.generated → 追加菜单/路由聚合入口。
- S5：新增“示例一键生成”按钮（10分钟跑通）。
- S6：补文档与最小测试（store/service 单测 + 路由集成测试）。

## 5. 验收标准（DoD）
- 新手不看文档可在10分钟内生成“用户管理”模块；菜单可见、路由可跳转、列表可分页、表单可增改、删除有确认与成功反馈。
- 四项质量门禁全部通过：`npm run type-check`、`npm run lint --fix`、`npm run test:coverage`（≥80%）、`npm run build`。
- Danger PR 检查通过；OpenAPI 客户端漂移检测无差异。

## 6. 风险与缓解
- 路由/菜单集成：避免直接改写手写文件，采用 `*.generated.ts` 聚合入口。
- OpenAPI 契约变更：默认使用本项目Swagger；外部数据源作为P1.5扩展能力。
- 范围蔓延：严格限制至P0（不做拖拽/预览）。

## 7. 计划与排期（理想工时）
- S1 类型与校验：0.5d
- S2 TemplatePack：0.5d
- S3 向导骨架：0.5d
- S4 串联与落地：0.5d
- S5 示例与文档：0.25d
- S6 质量门禁与修整：0.25d

## 8. 质量门禁执行
```bash
cd src/SmartAbp.Vue
npm run type-check
npm run lint --fix
npm run test:coverage
npm run build
```

## 9. 回滚策略
- 所有生成产物集中于 `src/appshell/*.generated.ts` 与 `modules/*/abp.module.json`；回滚仅需清理生成文件并恢复菜单/路由聚合入口。
