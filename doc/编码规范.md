# SmartAbp ç¼–ç è§„èŒƒ

> **ğŸ“‹ é…åˆã€Šé¡¹ç›®å¼€å‘é“å¾‹ã€‹çš„å…·ä½“æŠ€æœ¯è§„èŒƒ**

## ğŸ¯ ç¼–ç åŸåˆ™

### 1. **ä»£ç å¤ç”¨åŸåˆ™**
- **ä¸¥ç¦é‡å¤ä»£ç ** - å‘ç°ç›¸ä¼¼åŠŸèƒ½å¿…é¡»é‡æ„ä¸ºå…±äº«æ¨¡å—
- **ä¼˜å…ˆä½¿ç”¨ç°æœ‰å®ç°** - ç¼–å†™æ–°åŠŸèƒ½å‰å¿…é¡»æœç´¢ç°æœ‰ä»£ç 
- **ç»„ä»¶åŒ–æ€ç»´** - ä»»ä½•åŠŸèƒ½éƒ½è¦è€ƒè™‘å¤ç”¨æ€§

### 2. **æ¶æ„ä¸€è‡´æ€§**
- **éµå¾ªé¡¹ç›®æ¶æ„** - ä¸¥æ ¼æŒ‰ç…§ `doc/architecture/` æ–‡æ¡£æ‰§è¡Œ
- **ç›®å½•ç»“æ„è§„èŒƒ** - æŒ‰æ¨¡å—ç»„ç»‡ä»£ç 
- **å‘½åç»Ÿä¸€** - ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ

## ğŸ“ ç›®å½•ç»“æ„è§„èŒƒ

### å‰ç«¯ç›®å½•ç»“æ„
```
src/SmartAbp.Vue/src/
â”œâ”€â”€ views/                  # é¡µé¢è§†å›¾ï¼ˆæŒ‰æ¨¡å—åˆ†ç»„ï¼‰
â”‚   â”œâ”€â”€ user/              # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ project/           # é¡¹ç›®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ log/               # æ—¥å¿—ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ system/            # ç³»ç»Ÿç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â””â”€â”€ common/            # é€šç”¨é¡µé¢
â”œâ”€â”€ components/             # ç»„ä»¶ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç»„ï¼‰
â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ user/              # ç”¨æˆ·ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ log/               # æ—¥å¿—ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ theme/             # ä¸»é¢˜ç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ common/            # é€šç”¨ç»„ä»¶
â”œâ”€â”€ stores/                # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ modules/           # æŒ‰æ¨¡å—åˆ†ç»„çš„stores
â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ design-system/     # ç»Ÿä¸€è®¾è®¡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ base/              # åŸºç¡€æ ·å¼
â”‚   â”œâ”€â”€ components/        # ç»„ä»¶æ ·å¼
â”‚   â””â”€â”€ layouts/           # å¸ƒå±€æ ·å¼
â”œâ”€â”€ composables/           # ç»„åˆå¼å‡½æ•°
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â””â”€â”€ router/                # è·¯ç”±é…ç½®
```

### åç«¯ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ SmartAbp.Domain/           # åŸŸå±‚
â”œâ”€â”€ SmartAbp.Application/      # åº”ç”¨å±‚
â”œâ”€â”€ SmartAbp.Application.Contracts/  # åº”ç”¨åˆçº¦å±‚
â”œâ”€â”€ SmartAbp.HttpApi/          # HTTP APIå±‚
â”œâ”€â”€ SmartAbp.Web/              # Webå±‚
â””â”€â”€ SmartAbp.EntityFrameworkCore/    # æ•°æ®è®¿é—®å±‚
```

## ğŸ¨ å‰ç«¯ç¼–ç è§„èŒƒ

### Vueç»„ä»¶è§„èŒƒ
```vue
<template>
  <!-- ä½¿ç”¨è¯­ä¹‰åŒ–æ ‡ç­¾ -->
  <div class="user-management">
    <header class="page-header">
      <h1>{{ pageTitle }}</h1>
    </header>
    <main class="page-content">
      <!-- å†…å®¹ -->
    </main>
  </div>
</template>

<script setup lang="ts">
// 1. å¯¼å…¥é¡ºåºï¼šVue -> ç¬¬ä¸‰æ–¹ -> é¡¹ç›®å†…éƒ¨
import { ref, computed, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/stores/modules/user'

// 2. ç±»å‹å®šä¹‰
interface UserInfo {
  id: string
  name: string
  email: string
}

// 3. å“åº”å¼å˜é‡
const userStore = useUserStore()
const pageTitle = ref('ç”¨æˆ·ç®¡ç†')

// 4. è®¡ç®—å±æ€§
const formattedUsers = computed(() => {
  return userStore.users.map(user => ({
    ...user,
    displayName: `${user.name} (${user.email})`
  }))
})

// 5. æ–¹æ³•å®šä¹‰
const handleUserCreate = async (userData: UserInfo) => {
  try {
    await userStore.createUser(userData)
    ElMessage.success('ç”¨æˆ·åˆ›å»ºæˆåŠŸ')
  } catch (error) {
    ElMessage.error('ç”¨æˆ·åˆ›å»ºå¤±è´¥')
  }
}

// 6. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  userStore.fetchUsers()
})
</script>

<style scoped>
/* ä½¿ç”¨è®¾è®¡ç³»ç»Ÿå˜é‡ */
.user-management {
  padding: var(--spacing-4);
  background: var(--theme-bg-component);
}

.page-header {
  margin-bottom: var(--spacing-6);
  padding-bottom: var(--spacing-4);
  border-bottom: 1px solid var(--theme-border-base);
}

.page-content {
  /* å†…å®¹æ ·å¼ */
}
</style>
```

### TypeScriptè§„èŒƒ
```typescript
// 1. æ¥å£å®šä¹‰
export interface ApiResponse<T> {
  success: boolean
  data: T
  message?: string
  code?: number
}

// 2. ç±»å‹å®ˆå«
export function isValidUser(user: any): user is UserInfo {
  return user && 
         typeof user.id === 'string' && 
         typeof user.name === 'string' && 
         typeof user.email === 'string'
}

// 3. æ³›å‹ä½¿ç”¨
export async function apiRequest<T>(
  url: string, 
  options?: RequestOptions
): Promise<ApiResponse<T>> {
  // å®ç°
}

// 4. æšä¸¾å®šä¹‰
export enum UserRole {
  Admin = 'admin',
  User = 'user',
  Guest = 'guest'
}
```

### Pinia Storeè§„èŒƒ
```typescript
// stores/modules/user.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { UserInfo, CreateUserRequest } from '@/types/user'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€
  const users = ref<UserInfo[]>([])
  const loading = ref(false)
  const error = ref<string | null>(null)

  // è®¡ç®—å±æ€§
  const activeUsers = computed(() => 
    users.value.filter(user => user.status === 'active')
  )

  // æ“ä½œ
  const fetchUsers = async () => {
    loading.value = true
    error.value = null
    try {
      const response = await userApi.getUsers()
      users.value = response.data
    } catch (err) {
      error.value = 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥'
      throw err
    } finally {
      loading.value = false
    }
  }

  const createUser = async (userData: CreateUserRequest) => {
    try {
      const response = await userApi.createUser(userData)
      users.value.push(response.data)
      return response.data
    } catch (err) {
      error.value = 'åˆ›å»ºç”¨æˆ·å¤±è´¥'
      throw err
    }
  }

  return {
    // çŠ¶æ€
    users,
    loading,
    error,
    // è®¡ç®—å±æ€§
    activeUsers,
    // æ“ä½œ
    fetchUsers,
    createUser
  }
})
```

## ğŸ¯ è·¯ç”±è§„èŒƒ

### æ‰å¹³åŒ–è·¯ç”±ç»“æ„
```typescript
// router/index.ts
const routes = [
  {
    path: '/',
    redirect: '/dashboard'
  },
  {
    path: '/dashboard',
    component: SmartAbpLayout,
    name: 'Dashboard',
    meta: {
      title: 'å·¥ä½œå°',
      icon: 'dashboard',
      requiresAuth: true
    }
  },
  {
    path: '/User',
    component: SmartAbpLayout,
    meta: {
      title: 'ç”¨æˆ·ç®¡ç†',
      icon: 'user',
      requiresAuth: true,
      requiredRoles: ['admin']
    },
    children: [
      {
        path: '',
        name: 'UserList',
        component: () => import('@/views/user/UserListView.vue'),
        meta: { title: 'ç”¨æˆ·åˆ—è¡¨' }
      },
      {
        path: 'detail/:id',
        name: 'UserDetail',
        component: () => import('@/views/user/UserDetailView.vue'),
        meta: { title: 'ç”¨æˆ·è¯¦æƒ…' }
      }
    ]
  }
]
```

## ğŸ¨ æ ·å¼è§„èŒƒ

### è®¾è®¡ç³»ç»Ÿä½¿ç”¨
```css
/* âœ… æ­£ç¡®ï¼šä½¿ç”¨è®¾è®¡ç³»ç»Ÿå˜é‡ */
.button-primary {
  background: var(--theme-brand-primary);
  color: var(--theme-text-inverse);
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-md);
  border: 1px solid var(--theme-brand-primary);
}

/* âŒ é”™è¯¯ï¼šç¡¬ç¼–ç æ ·å¼å€¼ */
.button-primary {
  background: #0ea5e9;
  color: #ffffff;
  padding: 8px 16px;
  border-radius: 6px;
}
```

### CSSå‘½åè§„èŒƒ
```css
/* BEMå‘½åè§„èŒƒ */
.user-card { }                    /* å— */
.user-card__header { }            /* å…ƒç´  */
.user-card__title { }             /* å…ƒç´  */
.user-card--featured { }          /* ä¿®é¥°ç¬¦ */
.user-card__button--disabled { }  /* å…ƒç´ çš„ä¿®é¥°ç¬¦ */
```

## ğŸ”§ C# åç«¯ç¼–ç è§„èŒƒ

### æ§åˆ¶å™¨è§„èŒƒ
```csharp
[ApiController]
[Route("api/[controller]")]
public class UserController : SmartAbpController
{
    private readonly IUserAppService _userAppService;

    public UserController(IUserAppService userAppService)
    {
        _userAppService = userAppService;
    }

    [HttpGet]
    public async Task<PagedResultDto<UserDto>> GetListAsync(GetUsersInput input)
    {
        return await _userAppService.GetListAsync(input);
    }

    [HttpPost]
    public async Task<UserDto> CreateAsync(CreateUserDto input)
    {
        return await _userAppService.CreateAsync(input);
    }
}
```

### åº”ç”¨æœåŠ¡è§„èŒƒ
```csharp
public class UserAppService : SmartAbpAppService, IUserAppService
{
    private readonly IRepository<User, Guid> _userRepository;

    public UserAppService(IRepository<User, Guid> userRepository)
    {
        _userRepository = userRepository;
    }

    public async Task<PagedResultDto<UserDto>> GetListAsync(GetUsersInput input)
    {
        var query = await _userRepository.GetQueryableAsync();
        
        query = query.WhereIf(
            !input.Filter.IsNullOrWhiteSpace(),
            x => x.Name.Contains(input.Filter) || x.Email.Contains(input.Filter)
        );

        var totalCount = await AsyncExecuter.CountAsync(query);
        var users = await AsyncExecuter.ToListAsync(
            query.OrderBy(input.Sorting ?? "name")
                 .PageBy(input.SkipCount, input.MaxResultCount)
        );

        return new PagedResultDto<UserDto>(
            totalCount,
            ObjectMapper.Map<List<User>, List<UserDto>>(users)
        );
    }
}
```

## ğŸ“ å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½å
- **Vueç»„ä»¶**: PascalCase `UserManagementView.vue`
- **TypeScriptæ–‡ä»¶**: camelCase `userService.ts`
- **æ ·å¼æ–‡ä»¶**: kebab-case `user-management.css`
- **ç›®å½•**: kebab-case `user-management/`

### å˜é‡å‘½å
- **å˜é‡**: camelCase `userName`, `userList`
- **å¸¸é‡**: UPPER_SNAKE_CASE `API_BASE_URL`, `MAX_RETRY_COUNT`
- **å‡½æ•°**: camelCase `getUserList`, `handleUserCreate`
- **ç±»**: PascalCase `UserService`, `ApiClient`

### Gitæäº¤è§„èŒƒ
```
feat: æ·»åŠ ç”¨æˆ·ç®¡ç†åŠŸèƒ½
fix: ä¿®å¤ç™»å½•çŠ¶æ€ä¸¢å¤±é—®é¢˜
docs: æ›´æ–°APIæ–‡æ¡£
style: ä¼˜åŒ–ç”¨æˆ·åˆ—è¡¨æ ·å¼
refactor: é‡æ„ä¸»é¢˜ç³»ç»Ÿ
test: æ·»åŠ ç”¨æˆ·æœåŠ¡å•å…ƒæµ‹è¯•
chore: æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬
```

## ğŸš« ç¦æ­¢äº‹é¡¹

### ç»å¯¹ç¦æ­¢
1. **ç¡¬ç¼–ç é…ç½®** - æ‰€æœ‰é…ç½®å¿…é¡»externalized
2. **é­”æ³•æ•°å­—** - ä½¿ç”¨å‘½åå¸¸é‡
3. **console.log** - åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿ
4. **anyç±»å‹** - é™¤éç»å¯¹å¿…è¦ï¼Œä¼˜å…ˆä½¿ç”¨å…·ä½“ç±»å‹
5. **å†…è”æ ·å¼** - ä½¿ç”¨CSSç±»æˆ–è®¾è®¡ç³»ç»Ÿå˜é‡

### ä»£ç è´¨é‡è¦æ±‚
- **åœˆå¤æ‚åº¦** < 10
- **å‡½æ•°é•¿åº¦** < 50è¡Œ
- **ç±»é•¿åº¦** < 300è¡Œ
- **æ–‡ä»¶é•¿åº¦** < 500è¡Œ
- **æµ‹è¯•è¦†ç›–ç‡** > 80%

## âœ… ä»£ç æ£€æŸ¥æ¸…å•

### æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®æ¶æ„è®¾è®¡
- [ ] æ²¡æœ‰é‡å¤ä»£ç 
- [ ] ä½¿ç”¨äº†TypeScriptç±»å‹
- [ ] éµå¾ªå‘½åè§„èŒƒ
- [ ] æ·»åŠ äº†å¿…è¦æ³¨é‡Š
- [ ] é€šè¿‡äº†lintæ£€æŸ¥
- [ ] é€šè¿‡äº†ç±»å‹æ£€æŸ¥
- [ ] é€šè¿‡äº†æ„å»ºæ£€æŸ¥
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

**æœ€åæ›´æ–°ï¼š** 2024-01-09  
**é…åˆæ–‡æ¡£ï¼š** `doc/é¡¹ç›®å¼€å‘é“å¾‹.md`
